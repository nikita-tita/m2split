# ะะฐััะธัะตะฝะฝะพะต ะขะ: ะะพะปะธ, ะดะพัััะฟั, ัะผัะปััะธั ะธ ะฒะธะดะธะผะพััั ะฟะพะปะตะน

## 1. ะะพะปะธ ะธ ัะผัะปััะธั ัะพะปะตะน

### ะัะฝะพะฒะฝัะต ัะพะปะธ ัะธััะตะผั

1. **ะะฐัััะพะนัะธะบ-ะะดะผะธะฝ** - ััะฒะตัะถะดะตะฝะธะต ัะตะตัััะพะฒ, ะบะพะฝััะพะปั ะฒัะฟะปะฐั, ะพะฟะปะฐัะฐ ัะตัะฒะธัะฐ ะ2
2. **ะ2-ะะฟะตัะฐัะพั** - ัะพะทะดะฐะฝะธะต ัะดะตะปะพะบ, ัะพัะผะธัะพะฒะฐะฝะธะต ัะตะตัััะพะฒ, ะพัะฟัะฐะฒะบะฐ ะฒ ะฑะฐะฝะบ
3. **ะะ-ะะดะผะธะฝ** - ัะฟัะฐะฒะปะตะฝะธะต ัะฒะพะธะผะธ ัะดะตะปะบะฐะผะธ ะธ ะฐะณะตะฝัะฐะผะธ
4. **ะะณะตะฝั/ะะ/ะะะ** - ะฟัะพัะผะพัั ัะฒะพะธั ะฝะฐัะธัะปะตะฝะธะน, ะทะฐะณััะทะบะฐ ะฟะตัะฒะธัะบะธ
5. **ะััะณะฐะปัะตั/ะฎัะธัั ะะฐัััะพะนัะธะบะฐ** - ะฟัะพัะผะพัั ะดะพะบัะผะตะฝัะพะฒ ะธ ะฒัะฟะปะฐั (read-only+)

### ะญะผัะปััะธั ัะพะปะตะน (ะดะปั QA/ัะตััะธัะพะฒะฐะฝะธั)

**ะะบัะธะฒะฐัะธั:** ะกะตะปะตะบัะพั ะฒ ัะฐะฟะบะต ะฟัะพัะธะปั ยซะะตะถะธะผ: [ัะตะบััะฐั ัะพะปั] โพ โ ะญะผัะปััะธั ัะพะปะธยป
- ะะพัััะฟะฝะฐ ัะพะปัะบะพ ะฟัะธ ัะปะฐะณะต `can_emulate_roles=true` ะฒ ะฟัะพัะธะปะต ะฟะพะปัะทะพะฒะฐัะตะปั
- ะ UI ะฒะธะดะตะฝ ะฑะฐะฝะฝะตั ยซโ๏ธ ะะตะนััะฒัะตัะต ะบะฐะบ: [ัะพะปั] (ัะผัะปััะธั)ยป
- ะัะต ัะพะฑััะธั ะทะฐะฟะธััะฒะฐัั:
  - `acted_as_role` - ัะผัะปะธััะตะผะฐั ัะพะปั
  - `acted_as_party_id` - ัะผัะปะธััะตะผะฐั ะพัะณะฐะฝะธะทะฐัะธั
  - `emulated_by_user_id` - ัะตะฐะปัะฝัะน ะฟะพะปัะทะพะฒะฐัะตะปั

**ะะณัะฐะฝะธัะตะฝะธั ัะผัะปััะธะธ:**
- ะญะผัะปััะธั **ะะ ัะฐััะธััะตั** ะดะพัััะฟ ะบ ะดะฐะฝะฝัะผ
- ะะธะดะธะผะพััั ัะพะปัะบะพ ะฒ ัะฐะผะบะฐั ัะดะตะปะพะบ, ะณะดะต ัะผัะปะธััะตะผะฐั ัะพะปั ัะตะฐะปัะฝะพ ััะฐััะฒัะตั
- ะะตะปัะทั ัะพะทะดะฐัั ัะดะตะปะบั/ัะตะตััั ะฒะฝะต scope ัะผัะปะธััะตะผะพะน ััะพัะพะฝั

**API ััะตะฑะพะฒะฐะฝะธั:**
- ะะฐะณะพะปะพะฒะบะธ: `X-Act-As-Role` ะธ `X-Act-As-Party` ะพะฑัะทะฐัะตะปัะฝั ะฟัะธ ัะผัะปััะธะธ
- ะัะต ะทะฐะฟัะพัั ะปะพะณะธัััััั ั ะฟะพะปะฝะพะน ัะตะฟะพัะบะพะน: real_user โ emulated_role โ party

## 2. ะะฝะธัะธะฐัะพั ัะดะตะปะบะธ (ะฝะตะธะทะผะตะฝัะตะผะพะต)

### ะคะธะบัะฐัะธั ะฟัะธ ัะพะทะดะฐะฝะธะธ

ะัะธ ัะพะทะดะฐะฝะธะธ ัะดะตะปะบะธ ะฒ ะะ **ะฝะฐะฒัะตะณะดะฐ** ัะธะบัะธัััััั:
- `initiator_role` - ัะพะปั ัะพะทะดะฐัะตะปั (DEVELOPER_ADMIN | M2_OPERATOR | AGENCY_ADMIN)
- `initiator_party_id` - UUID ะพัะณะฐะฝะธะทะฐัะธะธ
- `initiator_user_id` - UUID ะฟะพะปัะทะพะฒะฐัะตะปั
- `initiator_timestamp` - ะดะฐัะฐ/ะฒัะตะผั ัะพะทะดะฐะฝะธั

### ะัะพะฑัะฐะถะตะฝะธะต ะฝะฐ ััะพะฝัะต

**ะจะฐะฟะบะฐ ะบะฐััะพัะบะธ ัะดะตะปะบะธ (ะดะปั ะฒัะตั ัะพะปะตะน):**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะกะดะตะปะบะฐ #d1 โข ะะ "ะกะพะปะฝะตัะฝัะน"                      โ
โ ะะฝะธัะธะฐัะพั: ะะ "ะะตะดะฒะธะถะธะผะพััั+" (ะ2-ะะฟะตัะฐัะพั)      โ
โ ะกะพะทะดะฐะฝะพ: 01.02.2024 14:35                       โ
โ ะกัะฐััั: ะ ัะฐะฑะพัะต                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะัะฐะฒะธะปะฐ:**
- ะะพะปะต **read-only** ะดะปั ะฒัะตั ัะพะปะตะน
- ะะต ะผะตะฝัะตััั ะฟัะธ ัะผัะปััะธะธ ัะพะปะธ
- ะัะพะฑัะฐะถะฐะตััั ะดะฐะถะต ะตัะปะธ initiator ะฑะพะปััะต ะฝะต ััะฐััะฒัะตั ะฒ ัะดะตะปะบะต

## 3. ะะฐััะธัะฐ ะฟัะฐะฒ (ะดะตัะฐะปะธะทะธัะพะฒะฐะฝะฝะฐั)

| ะะฑัะตะบั | ะะฐัััะพะนัะธะบ-ะะดะผะธะฝ | ะ2-ะะฟะตัะฐัะพั | ะะ-ะะดะผะธะฝ | ะะณะตะฝั/ะะ/ะะะ | ะััะณะฐะปัะตั/ะฎัะธัั |
|--------|------------------|-------------|----------|--------------|-----------------|
| **ะกะดะตะปะบะธ** | R/W, Approve ะฒัะพะด ะฒ ัะตะตััั | R/W (ัะพะทะดะฐะฝะธะต, ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต) | R/W (ัะพะปัะบะพ ัะฒะพะธ ัะดะตะปะบะธ) | R (ัะพะปัะบะพ ัะฒะพะธ ะดะพะปะธ) | R (ะฒัะต ัะดะตะปะบะธ) |
| **ะะตะตัััั** | Approve/Reject, R ะฒัะตั ัััะพะบ | Create/Edit/Send, R ะฒัะตั ัััะพะบ | R (ัะพะปัะบะพ ัะฒะพะธ ัััะพะบะธ) | R (ัะพะปัะบะพ ัะฒะพะธ ัััะพะบะธ) | R (ะฒัะต ัััะพะบะธ) |
| **ะัะฟะปะฐัั/ะกัะฐัััั** | R (ะฒัะต), ะะพะฒัะพั ะพัะฟัะฐะฒะบะธ | R (ะฒัะต), ะะพะฒัะพั ะพัะฟัะฐะฒะบะธ | R (ัะพะปัะบะพ ัะฒะพะธ) | R (ัะพะปัะบะพ ัะฒะพะธ) | R (ะฒัะต) |
| **ะะพะบัะผะตะฝัั ะฟะตัะฒะธัะบะธ** | R/Download (ะฒัะต) | R/Download (ะฒัะต), ะะพะผะฟะพะฝะพะฒะบะฐ ะฟะฐะบะตัะพะฒ | Upload (ัะฒะพะธ), R (ัะฒะพะธ) | Upload (ัะฒะพะธ), R (ัะฒะพะธ) | R/Download (ะฒัะต) |
| **ะะพะฝััะฐะณะตะฝัั/ะัะตััั** | Manage (ะฒัะต) | Manage (ะฒัะต) | R (ัะฒะพะธ ะบะพะฝััะฐะณะตะฝัั) | Accept ะพัะตััั | R (ะฒัะต) |
| **ะะฐัััะพะนะบะธ ััะตัะพะฒ/API** | Manage (ัะตะบะฒะธะทะธัั, ะพะฟะปะฐัะฐ) | Manage (ัะตัะฝะธัะตัะบะฐั ะฝะฐัััะพะนะบะฐ) | โ | โ | R (ะฟัะพัะผะพัั ัะตะบะฒะธะทะธัะพะฒ) |
| **ะญะผัะปััะธั ัะพะปะตะน** | No | Yes (ะฟัะธ can_emulate_roles) | No | No | No |

## 4. ะะพะดะตะปั ะดะฐะฝะฝัั: ะฟะพะปะฝะฐั ะฒะธะดะธะผะพััั ะฟะพะปะตะน

### ะะฐัะฐะฝัะธั

ะัะต ะฟะพะปั ะฝะธะถะต **ัััะตััะฒััั ะฒ ะะ** ะธ **ะดะพัััะฟะฝั ะฝะฐ ััะพะฝัะต** ัะพะณะปะฐัะฝะพ ะผะฐััะธัะต ะฟัะฐะฒ ะธ ััะฐะดะธะน.
ะคัะพะฝั **ะะ ัะบััะฒะฐะตั** ะฟะพะปั ะฒะฝะต ัะฐะทัะตััะฝะฝัั ะพะฟะตัะฐัะธะน - ะฟะพะบะฐะทัะฒะฐะตั ะบะฐะบ read-only ั ะฟะพะดัะบะฐะทะบะพะน.

### DEAL (ะกะดะตะปะบะฐ)

| ะะพะปะต | ะขะธะฟ | ะะธะดะธะผะพััั | R/W | UI |
|------|-----|-----------|-----|-----|
| `id` | UUID | ะะตะทะดะต | R: ะฒัะต | ะจะฐะฟะบะฐ ะบะฐััะพัะบะธ |
| `status` | enum | ะะตะทะดะต | W: ะ2 (ัะตัะฝ.), ะะฐัััะพะนัะธะบ (approve/reject); R: ะพััะฐะปัะฝัะต | Badge ะฒ ัะฐะฟะบะต |
| `initiator_role` | enum | ะะตะทะดะต | R: ะฒัะต | ะะปะพะบ "ะะฝะธัะธะฐัะพั" |
| `initiator_party_id` | UUID | ะะตะทะดะต | R: ะฒัะต | ะะปะพะบ "ะะฝะธัะธะฐัะพั" |
| `initiator_user_id` | UUID | ะะตะทะดะต | R: ะฒัะต | ะะปะพะบ "ะะฝะธัะธะฐัะพั" |
| `initiator_timestamp` | datetime | ะะตะทะดะต | R: ะฒัะต | ะะปะพะบ "ะะฝะธัะธะฐัะพั" |
| `parties[]` | array | ะะตะทะดะต | W: ะ2, ะะ-ะฐะดะผะธะฝ (ัะฒะพะธ); R: ะพััะฐะปัะฝัะต | ะะบะปะฐะดะบะฐ "ะกัะพัะพะฝั" |
| `object_name` | string | ะะตะทะดะต | W: ะ2; R: ะฒัะต | ะจะฐะฟะบะฐ ะบะฐััะพัะบะธ |
| `object_address` | string | ะะตะทะดะต | W: ะ2; R: ะฒัะต | ะจะฐะฟะบะฐ ะบะฐััะพัะบะธ |
| `lot_number` | string | ะะตะทะดะต | W: ะ2; R: ะฒัะต | ะัะฝะพะฒะฝะฐั ะธะฝัะพัะผะฐัะธั |
| `total_amount` | decimal | ะะตะทะดะต | W: ะ2; R: ะฒัะต | ะัะฝะพะฒะฝะฐั ะธะฝัะพัะผะฐัะธั |
| `shares[]` | array | Draft, In_registry | W: ะ2 (ะดะพ approve); R: ะฒัะต; ะฟะพัะปะต approve = R-only | ะขะฐะฑะปะธัะฐ "ะะฐัะฟัะตะดะตะปะตะฝะธะต ะดะพะปะตะน" |
| `contract_basis` | string | ะะตะทะดะต | W: ะ2, ะะฐัััะพะนัะธะบ; R: ะพััะฐะปัะฝัะต | ะัะฝะพะฒะฝะฐั ะธะฝัะพัะผะฐัะธั |
| `contract_number` | string | ะะตะทะดะต | W: ะ2, ะะฐัััะพะนัะธะบ; R: ะพััะฐะปัะฝัะต | ะัะฝะพะฒะฝะฐั ะธะฝัะพัะผะฐัะธั |
| `contract_date` | date | ะะตะทะดะต | W: ะ2, ะะฐัััะพะนัะธะบ; R: ะพััะฐะปัะฝัะต | ะัะฝะพะฒะฝะฐั ะธะฝัะพัะผะฐัะธั |
| `special_account_receipt_date` | date | ะะตะทะดะต | W: ะ2; R: ะฒัะต | ะัะฝะพะฒะฝะฐั ะธะฝัะพัะผะฐัะธั |
| `created_at` | datetime | ะะตะทะดะต | R: ะฒัะต | ะัะฝะพะฒะฝะฐั ะธะฝัะพัะผะฐัะธั |
| `updated_at` | datetime | ะะตะทะดะต | R: ะฒัะต | ะัะฝะพะฒะฝะฐั ะธะฝัะพัะผะฐัะธั |

### DEAL.shares[] (ะะพะปะธ)

| ะะพะปะต | ะขะธะฟ | ะะธะดะธะผะพััั | R/W | ะะฐะปะธะดะฐัะธั |
|------|-----|-----------|-----|-----------|
| `id` | UUID | ะะตะทะดะต | R: ะฒัะต | Auto |
| `contractor_id` | UUID | ะะตะทะดะต | W: ะ2 (ะดะพ approve); R: ะฒัะต | Required, FK |
| `role` | enum | ะะตะทะดะต | W: ะ2 (ะดะพ approve); R: ะฒัะต | AGENCY/AGENT/IP/NPD |
| `share_percent` | decimal | Draft, In_registry | W: ะ2 (ะดะพ approve); R: ะฒัะต | Sum = 100% |
| `amount` | decimal | Draft, In_registry | W: ะ2 (ะดะพ approve); R: ะฒัะต | Calculated |
| `tax_regime` | enum | ะะตะทะดะต | W: ะ2 (ะดะพ approve); R: ะฒัะต | VAT/USN/NPD |
| `vat_rate` | int | ะะตะทะดะต | W: ะ2 (ะดะพ approve); R: ะฒัะต | 0/10/20/22 (ะฟัะธ VAT) |
| `contract_number` | string | ะะตะทะดะต | W: ะ2 (ะดะพ approve); R: ะฒัะต | Required |
| `contract_date` | date | ะะตะทะดะต | W: ะ2 (ะดะพ approve); R: ะฒัะต | Required |

### REGISTRY (ะะตะตััั)

| ะะพะปะต | ะขะธะฟ | ะะธะดะธะผะพััั | R/W | ะะฟะธัะฐะฝะธะต |
|------|-----|-----------|-----|----------|
| `id` | UUID | ะก ัะพะทะดะฐะฝะธั | W: ะ2; R: ััะฐััะฝะธะบะธ | **Idempotency key** |
| `registry_number` | string | ะก ัะพะทะดะฐะฝะธั | W: ะ2; R: ััะฐััะฝะธะบะธ | Auto-generated |
| `date` | date | ะก ัะพะทะดะฐะฝะธั | W: ะ2; R: ััะฐััะฝะธะบะธ | ะะฐัะฐ ัะตะตัััะฐ |
| `status` | enum | ะก ัะพะทะดะฐะฝะธั | W: ะ2, ะะฐัััะพะนัะธะบ (approve); R: ะพััะฐะปัะฝัะต | DRAFT/PENDING/APPROVED/SENT/EXECUTED |
| `total_amount` | decimal | ะก ัะพะทะดะฐะฝะธั | R: ะฒัะต | Calculated |
| `lines_count` | int | ะก ัะพะทะดะฐะฝะธั | R: ะฒัะต | Calculated |
| `creator_id` | UUID | ะก ัะพะทะดะฐะฝะธั | R: ะฒัะต | ะ2-ะพะฟะตัะฐัะพั |
| `approver_id` | UUID | ะะพัะปะต approve | R: ะฒัะต | ะะฐัััะพะนัะธะบ |
| `approved_at` | datetime | ะะพัะปะต approve | R: ะฒัะต | Timestamp |
| `sent_to_bank_at` | datetime | ะะพัะปะต send | R: ะฒัะต | Timestamp |
| `executed_at` | datetime | ะะพัะปะต execute | R: ะฒัะต | Timestamp |
| `rejection_comment` | string | ะัะธ reject | R: ะฒัะต | ะัะธัะธะฝะฐ ะพัะบะปะพะฝะตะฝะธั |

### REGISTRY.lines[] (ะกััะพะบะธ ัะตะตัััะฐ)

| ะะพะปะต | ะขะธะฟ | ะะธะดะธะผะพััั | R/W | ะะฐะปะธะดะฐัะธั |
|------|-----|-----------|-----|-----------|
| `id` | UUID | In_registry โ Paid | R: ะฒัะต | Auto |
| `registry_id` | UUID | In_registry โ Paid | R: ะฒัะต | FK |
| `contractor_id` | UUID | In_registry โ Paid | R: ะฒัะต | FK |
| `role` | enum | In_registry โ Paid | W: ะ2 (ะดะพ approve); R: ะฒัะต | AGENCY/AGENT/IP/NPD |
| `inn` | string | In_registry โ Paid | W: ะ2 (ะดะพ approve); R: ะฒัะต | 10/12 digits |
| `account_number` | string | In_registry โ Paid | W: ะ2 (ะดะพ approve); R: ะฒัะต | 20 digits |
| `bik` | string | In_registry โ Paid | W: ะ2 (ะดะพ approve); R: ะฒัะต | 9 digits |
| `amount` | decimal | In_registry โ Paid | W: ะ2 (ะดะพ approve); R: ะฒัะต | > 0, 2 decimals |
| `tax_regime` | enum | In_registry โ Paid | W: ะ2 (ะดะพ approve); R: ะฒัะต | VAT/USN/NPD |
| `vat_rate` | int | In_registry โ Paid | W: ะ2 (ะดะพ approve); R: ะฒัะต | Required if VAT |
| `contract_number` | string | In_registry โ Paid | W: ะ2 (ะดะพ approve); R: ะฒัะต | Required |
| `contract_date` | date | In_registry โ Paid | W: ะ2 (ะดะพ approve); R: ะฒัะต | Required |
| `comment` | string | In_registry โ Paid | W: ะ2 (ะดะพ approve); R: ะฒัะต | Optional |
| `payment_status` | enum | ะะพัะปะต send | R: ะฒัะต | PENDING/ACCEPTED/EXECUTED/ERROR |
| `bank_error_code` | string | ะัะธ error | R: ะฒัะต | Bank error |
| `bank_error_text` | string | ะัะธ error | R: ะฒัะต | Bank message |

### PAYMENT (ะัะฟะปะฐัะฐ)

| ะะพะปะต | ะขะธะฟ | ะะธะดะธะผะพััั | R/W |
|------|-----|-----------|-----|
| `id` | UUID | ะะพัะปะต send | R: ะฒัะต |
| `registry_id` | UUID | ะะพัะปะต send | R: ะฒัะต |
| `line_id` | UUID | ะะพัะปะต send | R: ะฒัะต |
| `contractor_id` | UUID | ะะพัะปะต send | R: ะฒัะต |
| `amount` | decimal | ะะพัะปะต send | R: ะฒัะต |
| `status` | enum | ะะพัะปะต send | R: ะฒัะต |
| `bank_reference` | string | ะะพัะปะต accept | R: ะฒัะต |
| `bank_error_code` | string | ะัะธ error | R: ะฒัะต |
| `bank_error_text` | string | ะัะธ error | R: ะฒัะต |
| `executed_at` | datetime | ะะพัะปะต execute | R: ะฒัะต |

### PRIMARY_DOCUMENT (ะะตัะฒะธัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั)

| ะะพะปะต | ะขะธะฟ | ะะธะดะธะผะพััั | R/W |
|------|-----|-----------|-----|
| `id` | UUID | ะะพัะปะต ะฒัะฟะปะฐั | R: ะฒัะต |
| `payment_id` | UUID | ะะพัะปะต ะฒัะฟะปะฐั | R: ะฒัะต |
| `contractor_id` | UUID | ะะพัะปะต ะฒัะฟะปะฐั | R: ะฒัะต |
| `document_type` | enum | ะะพัะปะต ะฒัะฟะปะฐั | W: ะัะฟะพะปะฝะธัะตะปั; R: ะพััะฐะปัะฝัะต |
| `document_number` | string | ะะพัะปะต ะฒัะฟะปะฐั | W: ะัะฟะพะปะฝะธัะตะปั; R: ะพััะฐะปัะฝัะต |
| `document_date` | date | ะะพัะปะต ะฒัะฟะปะฐั | W: ะัะฟะพะปะฝะธัะตะปั; R: ะพััะฐะปัะฝัะต |
| `amount` | decimal | ะะพัะปะต ะฒัะฟะปะฐั | W: ะัะฟะพะปะฝะธัะตะปั; R: ะพััะฐะปัะฝัะต |
| `vat_amount` | decimal | ะะพัะปะต ะฒัะฟะปะฐั | W: ะัะฟะพะปะฝะธัะตะปั (ะฟัะธ VAT); R: ะพััะฐะปัะฝัะต |
| `file_url` | string | ะะพัะปะต ะฒัะฟะปะฐั | W: ะัะฟะพะปะฝะธัะตะปั; R: ะพััะฐะปัะฝัะต |
| `status` | enum | ะะพัะปะต ะฒัะฟะปะฐั | System |
| `rejection_reason` | string | ะัะธ reject | R: ะฒัะต |

## 5. ACL ะฟะพ ััะฐะดะธัะผ (Stage Access Control)

| ะะฑัะตะบั | DRAFT | IN_REGISTRY | APPROVED | SENT_TO_BANK | PAID |
|--------|-------|-------------|----------|--------------|------|
| **ะกะดะตะปะบะฐ (ะฟะพะปั)** | W: ะ2/ะะ-ะฐะดะผะธะฝ (ัะฒะพะธ) | R | R | R | R |
| **ะะพะปะธ** | W: ะ2 | R | R-only | R-only | R-only |
| **ะะตะตััั** | โ | W: ะ2 / Approve: ะะฐัััะพะนัะธะบ | R | R | R |
| **ะัะฟะปะฐัั/ะกัะฐัััั** | โ | โ | R (ะฟัััะพ) | R (ะพะฑะฝะพะฒะปัะตััั) | R (ัะธะฝะฐะป) |
| **ะะตัะฒะธัะบะฐ** | โ | โ | โ | Upload: ะัะฟะพะปะฝะธัะตะปั, Collect: ะ2 | R/Download: ะฒัะต |
| **ะกัะตั ะ2** | โ | โ | โ | โ | Issue/Pay |

## 6. UI ััะตะฑะพะฒะฐะฝะธั ะบ ะฒะธะดะธะผะพััะธ ะฟะพะปะตะน

### ะัะธะฝัะธะฟั ะพัะพะฑัะฐะถะตะฝะธั

1. **ะัะต ะฟะพะปั ะธะท ะผะพะดะตะปะธ ะดะฐะฝะฝัั ะฟัะธัััััะฒััั** ะฒ UI ะฒ ัะตะถะธะผะต read-only ะธะปะธ editable
2. **ะกะบัััะธะต ะฟะพะปะตะน ะดะพะฟัััะธะผะพ** ัะพะปัะบะพ ะฟะพ stage/role ACL
3. **ะขะตัะฝะธัะตัะบะฐั ะฟะพะดัะบะฐะทะบะฐ** ะฟัะธ ะฝะฐะฒะตะดะตะฝะธะธ ะฝะฐ disabled ะฟะพะปะต:
   ```
   ๐ ะะพะปะต ะฝะตะดะพัััะฟะฝะพ ะดะปั ัะตะดะฐะบัะธัะพะฒะฐะฝะธั
   ะััะพัะฝะธะบ: DEAL.shares[].amount
   ะขะตะบััะฐั ัะพะปั: ะะ-ะะดะผะธะฝ
   ะัะธัะธะฝะฐ: R-only ะฟะพัะปะต ะฟะตัะตัะพะดะฐ ะฒ ััะฐััั APPROVED
   ```

### ะญะบัะฟะพัั ะดะฐะฝะฝัั

**CSV/JSON/Excel ัะบัะฟะพัั ัะพะดะตัะถะธั:**
- ะัะต ะฟะพะปั, ะดะพัััะฟะฝัะต ัะพะปะธ ัะบัะฟะพััััะฐ
- ะะฐะฟะฟะธะฝะณ "UI ะฝะฐะทะฒะฐะฝะธะต โ ะะ ะฟะพะปะต" ะดะพะบัะผะตะฝัะธัะพะฒะฐะฝ
- ะะปั ัะตะตัััะพะฒ: ะฟะพะปะฝะพะต ัะพะพัะฒะตัััะฒะธะต ะฑะฐะฝะบะพะฒัะบะพะผั ัะฐะฑะปะพะฝั

### ะะฐะปะธะดะฐัะธะธ ะฝะฐ ััะพะฝัะต

**ะะฑัะทะฐัะตะปัะฝั ะธ ะธะดะตะฝัะธัะฝั ะะ:**
- ะะะ: 10 ะธะปะธ 12 ัะธัั
- ะ/ั: 20 ัะธัั
- ะะะ: 9 ัะธัั
- ะกัะผะผะฐ: > 0, max 2 ะทะฝะฐะบะฐ ะฟะพัะปะต ะทะฐะฟััะพะน
- ะะพะปะธ: ััะผะผะฐ = 100% (ัะพัะฝะพััั 0.01%)
- VAT rate: ะพะฑัะทะฐัะตะปะตะฝ ัะพะปัะบะพ ะฟัะธ tax_regime = VAT
- ะัะฝะพะฒะฐะฝะธะต ะฒัะฟะปะฐัั: ะพะฑัะทะฐัะตะปัะฝะพ (contract_number + contract_date)

## 7. ะัะดะธั ะธ ะปะพะณะธัะพะฒะฐะฝะธะต

### ะกัััะบัััะฐ audit log

```typescript
interface AuditLogEntry {
  id: string;
  timestamp: Date;

  // ะะตะฐะปัะฝัะน ะฟะพะปัะทะพะฒะฐัะตะปั
  performed_by_user_id: string;
  performed_by_role: UserRole;

  // ะญะผัะปััะธั (ะตัะปะธ ะตััั)
  acted_as_role?: UserRole;
  acted_as_party_id?: string;
  emulated_by_user_id?: string;

  // ะะตะนััะฒะธะต
  entity_type: 'DEAL' | 'REGISTRY' | 'PAYMENT' | 'CONTRACTOR' | 'DOCUMENT';
  entity_id: string;
  action: string; // 'create', 'update', 'approve', 'send', etc.

  // ะะทะผะตะฝะตะฝะธั
  before?: Record<string, any>;
  after?: Record<string, any>;

  // ะะพะฝัะตะบัั
  source: 'UI' | 'API';
  ip_address: string;
  user_agent?: string;
}
```

### ะัะธัะธัะตัะบะธะต ะพะฟะตัะฐัะธะธ

**ะะฑัะทะฐัะตะปัะฝะฐ ะธะดะตะผะฟะพัะตะฝัะฝะพััั (REGISTRY.id):**
- ะกะพะทะดะฐะฝะธะต ัะตะตัััะฐ
- ะัะฟัะฐะฒะบะฐ ัะฐัะฟะพััะถะตะฝะธั ะฒ ะฑะฐะฝะบ
- ะะพะฒัะพัะฝะฐั ะพัะฟัะฐะฒะบะฐ ะฟัะธ ะพัะธะฑะบะต

**ะะพะณ ัะพะดะตัะถะธั:**
- Payload hash (SHA-256)
- Bank response/receipt
- Retry attempts

## 8. ะัะธัะตัะธะธ ะฟัะธัะผะบะธ

### 8.1 ะะฝะธัะธะฐัะพั ัะดะตะปะบะธ
โ ะัะธ ัะพะทะดะฐะฝะธะธ ัะดะตะปะบะธ ะพั ะธะผะตะฝะธ ะะ-ะฐะดะผะธะฝะฐ ะฟะพะปะต "ะะฝะธัะธะฐัะพั" ัะธะบัะธััะตััั
โ ะะฝะธัะธะฐัะพั ะฒะธะดะตะฝ ะฒัะตะผ ััะฐััะฝะธะบะฐะผ ะบะฐะบ read-only
โ ะะฝะธัะธะฐัะพั ะฝะต ะผะตะฝัะตััั ะฟัะธ ะฟะตัะตัะพะดะฐั ััะฐัััะพะฒ
โ ะะฝะธัะธะฐัะพั ะฒะธะดะตะฝ ะดะฐะถะต ะตัะปะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะฟะพะบะธะฝัะป ัะดะตะปะบั

### 8.2 ะญะผัะปััะธั ัะพะปะตะน
โ ะะตัะตะบะปััะตะฝะธะต ัะพะปะธ ะดะพัััะฟะฝะพ ัะพะปัะบะพ ะฟัะธ can_emulate_roles=true
โ ะะฐะฝะฝะตั ัะผัะปััะธะธ ะฒะธะดะตะฝ ะฒะพ ะฒัะตั ัะฐะทะดะตะปะฐั
โ ะัะต ะดะตะนััะฒะธั ะฟะพะผะตัะตะฝั ะฒ audit log ะบะฐะบ emulated
โ ะญะผัะปััะธั ะฝะต ัะฐััะธััะตั scope ะดะพัััะฟะฐ

### 8.3 ะะธะดะธะผะพััั ะฟะพะปะตะน ะะ
โ ะัะต ะฟะพะปั ะผะพะดะตะปะธ ะดะฐะฝะฝัั ะพัะพะฑัะฐะถะฐัััั ะฝะฐ ััะพะฝัะต
โ Disabled ะฟะพะปั ะฟะพะบะฐะทัะฒะฐัั ะฟัะธัะธะฝั ะฝะตะดะพัััะฟะฝะพััะธ
โ ะะตั "ะฝะตะฒะธะดะธะผัั" ะฟะพะปะตะน, ัะบััััั ะพั UI
โ ะญะบัะฟะพัั XLS ัะพะฒะฟะฐะดะฐะตั ั ะผะพะดะตะปัั ะะ (ะผะฐะฟะฟะธะฝะณ ะทะฐะดะพะบัะผะตะฝัะธัะพะฒะฐะฝ)

### 8.4 ะะดะตะผะฟะพัะตะฝัะฝะพััั
โ ะะพะฒัะพัะฝะฐั ะพัะฟัะฐะฒะบะฐ ัะตะตัััะฐ ั ัะตะผ ะถะต REGISTRY.id ะฝะต ัะพะทะดะฐัั ะดัะฑะปั
โ Bank API ะฟะพะปััะฐะตั ัะพั ะถะต payload hash ะฟัะธ retry
โ ะะพะณ ัะพะดะตัะถะธั ะฒัะต ะฟะพะฟััะบะธ ะพัะฟัะฐะฒะบะธ

### 8.5 Stage ACL
โ ะะพะปั ัะดะตะปะบะธ ะฝะตัะตะดะฐะบัะธััะตะผั ะฟะพัะปะต APPROVED
โ ะะพะปะธ ะฝะตัะตะดะฐะบัะธััะตะผั ะฟะพัะปะต APPROVED
โ ะะตะตััั ะฝะตัะตะดะฐะบัะธััะตะผ ะฟะพัะปะต APPROVED (ัะพะปัะบะพ ะะฐัััะพะนัะธะบ ะผะพะถะตั reject)
โ ะะตัะฒะธัะบะฐ ะทะฐะณััะถะฐะตััั ัะพะปัะบะพ ะฟะพัะปะต SENT_TO_BANK

---

## ะัะธะปะพะถะตะฝะธะต: ะัะธะผะตัั UI

### ะจะฐะฟะบะฐ ั ัะผัะปััะธะตะน

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ๏ธ ะะตะนััะฒัะตัะต ะบะฐะบ: ะะ "ะะตะดะฒะธะถะธะผะพััั+" (ัะผัะปััะธั)        โ
โ ะะตะฐะปัะฝะฐั ัะพะปั: ะ2-ะะฟะตัะฐัะพั                              โ
โ [ะัะนัะธ ะธะท ัะผัะปััะธะธ]                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะฐััะพัะบะฐ ัะดะตะปะบะธ ั ะธะฝะธัะธะฐัะพัะพะผ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะกะดะตะปะบะฐ #d1 โข ะะ "ะกะพะปะฝะตัะฝัะน", ะบะฒ. 45                       โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ ๐ค ะะฝะธัะธะฐัะพั: ะะ "ะะตะดะฒะธะถะธะผะพััั+" (ะ2-ะะฟะตัะฐัะพั)        โ โ
โ โ    ะกะพะทะดะฐะฝะพ: 01.02.2024 14:35:22                       โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ ะกัะฐััั: ะ ัะฐะฑะพัะต ๐                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Disabled ะฟะพะปะต ั ะฟะพะดัะบะฐะทะบะพะน

```
ะะพะปั %: 60.00 % ๐
โโโโโโโโโโโโโโโโ
๐ ะะพะปะต ะฝะตะดะพัััะฟะฝะพ ะดะปั ัะตะดะฐะบัะธัะพะฒะฐะฝะธั

ะััะพัะฝะธะบ: DEAL.shares[0].share_percent
ะขะตะบััะฐั ัะพะปั: ะะ-ะะดะผะธะฝ
ะัะธัะธะฝะฐ: ะะพะปะต ะฝะตัะตะดะฐะบัะธััะตะผะพ ะฟะพัะปะต ะฟะตัะตัะพะดะฐ
        ัะดะตะปะบะธ ะฒ ััะฐััั APPROVED
```
