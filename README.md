# M2 Split - Система распределения комиссий

Платформа для управления выплатами и распределением комиссий в сделках с недвижимостью.

## Описание

M2 Split — это веб-приложение для автоматизации процессов распределения комиссий между участниками сделок с недвижимостью (застройщики, агентства, агенты, самозанятые).

### Основные возможности

#### Роли пользователей
- **Застройщик-Админ**: утверждение реестров, просмотр статусов, оплата сервиса
- **М2-Оператор**: создание сделок, формирование реестров, отправка в банк
- **Исполнитель**: просмотр начислений, загрузка первички
- **Банк**: read-only доступ к статусам

#### Функционал

1. **Дашборд**
   - Метрики: сумма на спецсчёте, выплаты за период, статусы
   - Полнота первичной документации
   - Экономия НДС

2. **Сделки**
   - Создание и управление сделками
   - Распределение долей между участниками
   - Валидация (доли = 100%, реквизиты, основания)
   - Поддержка разных режимов налогообложения (НДС, УСН, НПД)

3. **Реестры выплат**
   - Конструктор реестров
   - Согласование с застройщиком
   - Отправка в банк
   - Экспорт в CSV/JSON

4. **Выплаты**
   - Мониторинг статусов от банка
   - Обработка ошибок
   - История операций

5. **Документы**
   - Загрузка первички (акты, счета-фактуры, чеки НПД)
   - Формирование пакетов для застройщика
   - Счета сервиса М2

6. **Контрагенты**
   - Справочник исполнителей
   - Управление офертами
   - Статусы присоединения

7. **Настройки**
   - Реквизиты организаций
   - Банковские счета
   - API и вебхуки

## Технологический стек

- **Frontend**: Next.js 15, React 19, TypeScript
- **Styling**: Tailwind CSS
- **State Management**: Zustand
- **Icons**: Lucide React
- **Utilities**: date-fns, clsx

## Установка и запуск

### Требования
- Node.js 18+
- npm или yarn

### Установка зависимостей

\`\`\`bash
npm install
\`\`\`

### Запуск в режиме разработки

\`\`\`bash
npm run dev
\`\`\`

Приложение будет доступно по адресу [http://localhost:3000](http://localhost:3000)

### Сборка для production

\`\`\`bash
npm run build
npm start
\`\`\`

## Структура проекта

\`\`\`
m2split/
├── app/                    # Next.js App Router
│   ├── dashboard/         # Дашборд
│   ├── deals/            # Сделки
│   ├── registries/       # Реестры
│   ├── payments/         # Выплаты
│   ├── documents/        # Документы
│   ├── contractors/      # Контрагенты
│   └── settings/         # Настройки
├── components/            # React компоненты
│   ├── ui/               # UI компоненты (Button, Card, Table)
│   ├── dashboard/        # Компоненты дашборда
│   └── Layout.tsx        # Основной layout с навигацией
├── lib/                   # Утилиты и хелперы
│   ├── store.ts          # Zustand store
│   ├── validations.ts    # Валидации и форматирование
│   ├── export.ts         # Экспорт данных
│   └── mock-data.ts      # Демо-данные
└── types/                 # TypeScript типы
    └── index.ts          # Интерфейсы данных
\`\`\`

## Деплой на Vercel

### 1. Подготовка

Убедитесь, что у вас есть аккаунт на [Vercel](https://vercel.com)

### 2. Через GitHub (рекомендуется)

1. Создайте репозиторий на GitHub
2. Загрузите код:
   \`\`\`bash
   git init
   git add .
   git commit -m "Initial commit"
   git branch -M main
   git remote add origin https://github.com/YOUR_USERNAME/m2split.git
   git push -u origin main
   \`\`\`

3. Перейдите на [vercel.com](https://vercel.com)
4. Нажмите "Import Project"
5. Выберите ваш GitHub репозиторий
6. Vercel автоматически определит Next.js и настроит деплой
7. Нажмите "Deploy"

### 3. Через Vercel CLI

\`\`\`bash
npm install -g vercel
vercel login
vercel
\`\`\`

Следуйте инструкциям в терминале.

### 4. Настройка после деплоя

После успешного деплоя:
- Ваш проект будет доступен по адресу типа `https://m2split-xxxxx.vercel.app`
- Можно настроить свой домен в настройках проекта на Vercel

## Демо-данные

Приложение включает демо-данные для демонстрации функционала:
- 3 пользователя (застройщик, оператор, исполнитель)
- 3 контрагента (АН, агент, самозанятый)
- 2 сделки с распределением долей
- 1 реестр с 3 выплатами
- Различные статусы выплат

## Валидации

Система включает валидацию:
- ИНН: 10 или 12 цифр
- Номер счёта: 20 цифр
- БИК: 9 цифр
- Суммы: положительные числа с макс. 2 знаками после запятой
- Доли: сумма должна равняться 100%
- Ставка НДС: только для режима VAT

## API и экспорт

### Форматы экспорта
- **CSV**: для импорта в Excel/банковские системы
- **JSON**: для интеграций и API
- **ZIP**: пакеты документов

### Вебхуки
Система поддерживает вебхуки для:
- Статусов выплат от банка
- Изменений в реестрах
- Загрузки документов

## Безопасность

- Валидация всех входных данных
- Контроль прав доступа по ролям
- Аудит всех изменений
- Idempotency для операций с банком

## Лицензия

Proprietary

## Поддержка

Для вопросов и поддержки: support@m2split.ru
