"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{9379:function(e,t,r){r.d(t,{C:function(){return o}});var n=r(7437);r(2265);var a=r(1994);let o=e=>{let{children:t,variant:r="default",size:o="md"}=e;return(0,n.jsx)("span",{className:(0,a.W)("inline-flex items-center rounded-full font-medium",{default:"bg-gray-100 text-gray-800",success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",danger:"bg-red-100 text-red-800",info:"bg-blue-100 text-blue-800"}[r],{sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-1 text-sm"}[o]),children:t})}},8068:function(e,t,r){r.d(t,{I:function(){return o},P:function(){return c}});var n=r(7437);r(2265);var a=r(1994);let o=e=>{let{label:t,error:r,helperText:o,className:c,...i}=e;return(0,n.jsxs)("div",{className:"w-full",children:[t&&(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),(0,n.jsx)("input",{className:(0,a.W)("w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",r?"border-red-300":"border-gray-300",c),...i}),r&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:r}),o&&!r&&(0,n.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o})]})},c=e=>{let{label:t,error:r,options:o,className:c,...i}=e;return(0,n.jsxs)("div",{className:"w-full",children:[t&&(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),(0,n.jsx)("select",{className:(0,a.W)("w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",r?"border-red-300":"border-gray-300",c),...i,children:o.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))}),r&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:r})]})}},3694:function(e,t,r){r.d(t,{G:function(){return o},L$:function(){return d},bs:function(){return n},dp:function(){return a},kG:function(){return i},nh:function(){return c}});let n=[{id:"1",email:"admin@developer.ru",name:"Иван Застройщиков",role:"DEVELOPER_ADMIN",createdAt:new Date("2024-01-01")},{id:"2",email:"operator@m2split.ru",name:"Мария Операторова",role:"M2_OPERATOR",createdAt:new Date("2024-01-01")},{id:"3",email:"agency@realty.ru",name:'АН "Недвижимость+"',role:"CONTRACTOR",createdAt:new Date("2024-01-15")}],a=[{id:"c1",type:"AGENCY",name:'АН "Недвижимость Плюс"',inn:"7701234567",kpp:"770101001",accountNumber:"40702810100000001234",bik:"044525225",bankName:"ПАО Сбербанк",address:"г. Москва, ул. Примерная, д. 1",offerAcceptedAt:new Date("2024-02-01"),offerAcceptanceChannel:"email",createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-02-01")},{id:"c2",type:"AGENT",name:"Петров Петр Петрович",inn:"771234567890",accountNumber:"40817810200000002345",bik:"044525225",bankName:"ПАО Сбербанк",address:"г. Москва, ул. Агентская, д. 2",offerAcceptedAt:new Date("2024-02-05"),offerAcceptanceChannel:"web",createdAt:new Date("2024-01-20"),updatedAt:new Date("2024-02-05")},{id:"c3",type:"NPD",name:"Сидорова Анна Ивановна",inn:"123456789012",accountNumber:"40817810300000003456",bik:"044525974",bankName:"ПАО ВТБ",address:"г. Санкт-Петербург, пр. Невский, д. 100",offerAcceptedAt:new Date("2024-02-10"),offerAcceptanceChannel:"mobile",createdAt:new Date("2024-01-25"),updatedAt:new Date("2024-02-10")}],o=[{id:"d1",objectName:'ЖК "Солнечный"',objectAddress:"г. Москва, ул. Солнечная, д. 10, корп. 1",lotNumber:"Кв. 45",developerId:"1",totalAmount:15e6,status:"IN_PROGRESS",shares:[{id:"s1",contractorId:"c1",contractor:a[0],role:"AGENCY",sharePercent:60,amount:9e6,taxRegime:"OSN",vatRate:20,contractNumber:"АГ-001/2024",contractDate:new Date("2024-02-01")},{id:"s2",contractorId:"c2",contractor:a[1],role:"AGENT",sharePercent:30,amount:45e5,taxRegime:"USN",contractNumber:"АГ-002/2024",contractDate:new Date("2024-02-05")},{id:"s3",contractorId:"c3",contractor:a[2],role:"NPD",sharePercent:10,amount:15e5,taxRegime:"NPD",contractNumber:"АГ-003/2024",contractDate:new Date("2024-02-10")}],contractBasis:"Договор комиссии",contractNumber:"ДК-2024-001",contractDate:new Date("2024-02-01"),specialAccountReceiptDate:new Date("2024-02-15"),responsibleUserId:"2",initiator:{role:"M2_OPERATOR",partyId:"1",userId:"2",timestamp:new Date("2024-02-01")},createdAt:new Date("2024-02-01"),updatedAt:new Date("2024-02-15")},{id:"d2",objectName:'ЖК "Морской бриз"',objectAddress:"г. Санкт-Петербург, наб. Морская, д. 5",lotNumber:"Кв. 102",developerId:"1",totalAmount:22e6,status:"DRAFT",shares:[{id:"s4",contractorId:"c1",contractor:a[0],role:"AGENCY",sharePercent:70,amount:154e5,taxRegime:"OSN",vatRate:20},{id:"s5",contractorId:"c2",contractor:a[1],role:"AGENT",sharePercent:30,amount:66e5,taxRegime:"USN"}],responsibleUserId:"2",initiator:{role:"AGENCY_ADMIN",partyId:"c1",userId:"3",timestamp:new Date("2024-03-01")},createdAt:new Date("2024-03-01"),updatedAt:new Date("2024-03-01")}],c=[{id:"r1",registryNumber:"РЕЕ-2024-001",date:new Date("2024-03-15"),status:"APPROVED",totalAmount:15e6,linesCount:3,creatorId:"2",approverId:"1",approvedAt:new Date("2024-03-16"),lines:[{id:"l1",registryId:"r1",contractorId:"c1",contractor:a[0],role:"AGENCY",inn:"7701234567",accountNumber:"40702810100000001234",bik:"044525225",amount:9e6,taxRegime:"OSN",vatRate:20,contractNumber:"АГ-001/2024",contractDate:new Date("2024-02-01"),comment:"Комиссия за сделку ЖК Солнечный кв.45",paymentStatus:"PENDING",createdAt:new Date("2024-03-15"),updatedAt:new Date("2024-03-15")},{id:"l2",registryId:"r1",contractorId:"c2",contractor:a[1],role:"AGENT",inn:"771234567890",accountNumber:"40817810200000002345",bik:"044525225",amount:45e5,taxRegime:"USN",contractNumber:"АГ-002/2024",contractDate:new Date("2024-02-05"),comment:"Агентское вознаграждение",paymentStatus:"PENDING",createdAt:new Date("2024-03-15"),updatedAt:new Date("2024-03-15")},{id:"l3",registryId:"r1",contractorId:"c3",contractor:a[2],role:"NPD",inn:"123456789012",accountNumber:"40817810300000003456",bik:"044525974",amount:15e5,taxRegime:"NPD",contractNumber:"АГ-003/2024",contractDate:new Date("2024-02-10"),comment:"Услуги самозанятого",paymentStatus:"PENDING",createdAt:new Date("2024-03-15"),updatedAt:new Date("2024-03-15")}],createdAt:new Date("2024-03-15"),updatedAt:new Date("2024-03-16")}],i=[{id:"p1",registryId:"r1",lineId:"l1",contractorId:"c1",amount:9e6,status:"EXECUTED",bankReference:"BNK-2024-001",executedAt:new Date("2024-03-17"),createdAt:new Date("2024-03-16"),updatedAt:new Date("2024-03-17")},{id:"p2",registryId:"r1",lineId:"l2",contractorId:"c2",amount:45e5,status:"ACCEPTED_BY_BANK",bankReference:"BNK-2024-002",createdAt:new Date("2024-03-16"),updatedAt:new Date("2024-03-16")},{id:"p3",registryId:"r1",lineId:"l3",contractorId:"c3",amount:15e5,status:"ERROR",bankErrorCode:"ERR-01",bankErrorText:"Неверный номер счёта получателя",createdAt:new Date("2024-03-16"),updatedAt:new Date("2024-03-16")}],d={specialAccountBalance:37e6,paidThisPeriod:9e6,pendingPayments:6e6,errorPayments:15e5,primaryDocCompletion:33.33,vatSavings:18e5}},9057:function(e,t,r){r.d(t,{f:function(){return c}});var n=r(2141),a=r(3694);class o{async getCounterparties(e){if(!(0,n.jv)())return console.warn("\uD83D\uDCE6 Using mock data (Supabase not configured)"),a.dp;try{let t=n.OQ.from("counterparties").select("*").order("created_at",{ascending:!1});(null==e?void 0:e.type)&&(t=t.eq("type",e.type)),(null==e?void 0:e.offerAccepted)!==void 0&&(t=e.offerAccepted?t.not("offer_accepted_at","is",null):t.is("offer_accepted_at",null));let{data:r,error:a}=await t;if(a)throw a;return(r||[]).map(this.transformFromDB)}catch(e){throw console.error("Error fetching counterparties:",e),e}}async getCounterparty(e){if(!(0,n.jv)())return a.dp.find(t=>t.id===e)||null;try{let{data:t,error:r}=await n.OQ.from("counterparties").select("*").eq("id",e).single();if(r)throw r;if(!t)return null;return this.transformFromDB(t)}catch(e){return console.error("Error fetching counterparty:",e),null}}async createCounterparty(e){if(!(0,n.jv)())throw Error("Supabase not configured");try{let{data:t,error:r}=await n.OQ.from("counterparties").insert({type:e.type,name:e.name,inn:e.inn,kpp:e.kpp,account_number:e.accountNumber,bik:e.bik,bank_name:e.bankName,email:e.email,phone:e.phone}).select().single();if(r)throw r;if(!t)throw Error("Failed to create counterparty");return this.transformFromDB(t)}catch(e){throw console.error("Error creating counterparty:",e),e}}async updateCounterparty(e,t){if(!(0,n.jv)())throw Error("Supabase not configured");try{let{data:r,error:a}=await n.OQ.from("counterparties").update({type:t.type,name:t.name,inn:t.inn,kpp:t.kpp,account_number:t.accountNumber,bik:t.bik,bank_name:t.bankName,email:t.email,phone:t.phone}).eq("id",e).select().single();if(a)throw a;if(!r)throw Error("Counterparty not found");return this.transformFromDB(r)}catch(e){throw console.error("Error updating counterparty:",e),e}}async acceptOffer(e){if(!(0,n.jv)())throw Error("Supabase not configured");try{let{data:t,error:r}=await n.OQ.from("counterparties").update({offer_accepted_at:new Date().toISOString()}).eq("id",e).select().single();if(r)throw r;if(!t)throw Error("Counterparty not found");return this.transformFromDB(t)}catch(e){throw console.error("Error accepting offer:",e),e}}transformFromDB(e){return{id:e.id,name:e.name,inn:e.inn,type:e.type,kpp:e.kpp,accountNumber:e.account_number,bik:e.bik,bankName:e.bank_name,email:e.email,phone:e.phone,offerAcceptedAt:e.offer_accepted_at?new Date(e.offer_accepted_at):void 0,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}}let c=new o},8509:function(e,t,r){r.d(t,{W:function(){return c}});var n=r(2141);let a=[];class o{async logEvent(e){let t={id:"evt".concat(Date.now()),type:e.type,entityType:e.entityType,entityId:e.entityId,userId:e.userId,userName:e.userName,userRole:e.userRole,description:e.description,metadata:e.metadata,timestamp:new Date};if(!(0,n.jv)())return a.push(t),console.log("\uD83D\uDCDD Event logged:",t),t;try{let{data:e,error:r}=await n.OQ.from("events").insert([{type:t.type,entity_type:t.entityType,entity_id:t.entityId,user_id:t.userId,user_name:t.userName,user_role:t.userRole,description:t.description,metadata:t.metadata,timestamp:t.timestamp}]).select().single();if(r)throw r;return{...t,id:e.id}}catch(e){return console.error("Failed to log event:",e),a.push(t),t}}async getEventsForEntity(e,t){if(!(0,n.jv)())return a.filter(r=>r.entityType===e&&r.entityId===t).sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime());try{let{data:r,error:a}=await n.OQ.from("events").select("*").eq("entity_type",e).eq("entity_id",t).order("timestamp",{ascending:!1});if(a)throw a;return(r||[]).map(this.mapEvent)}catch(e){return console.error("Failed to fetch events:",e),[]}}async getAllEvents(e){if(!(0,n.jv)()){let t=[...a];return(null==e?void 0:e.entityType)&&(t=t.filter(t=>t.entityType===e.entityType)),(null==e?void 0:e.userId)&&(t=t.filter(t=>t.userId===e.userId)),(null==e?void 0:e.type)&&(t=t.filter(t=>t.type===e.type)),t.sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime()),(null==e?void 0:e.limit)&&(t=t.slice(0,e.limit)),t}try{let t=n.OQ.from("events").select("*").order("timestamp",{ascending:!1});(null==e?void 0:e.entityType)&&(t=t.eq("entity_type",e.entityType)),(null==e?void 0:e.userId)&&(t=t.eq("user_id",e.userId)),(null==e?void 0:e.type)&&(t=t.eq("type",e.type)),(null==e?void 0:e.limit)&&(t=t.limit(e.limit));let{data:r,error:a}=await t;if(a)throw a;return(r||[]).map(this.mapEvent)}catch(e){return console.error("Failed to fetch events:",e),[]}}clearEventLog(){a=[]}mapEvent(e){return{id:e.id,type:e.type,entityType:e.entity_type,entityId:e.entity_id,userId:e.user_id,userName:e.user_name,userRole:e.user_role,description:e.description,metadata:e.metadata,timestamp:new Date(e.timestamp)}}}let c=new o},2141:function(e,t,r){r.d(t,{OQ:function(){return u},jv:function(){return i}});var n=r(1545),a=r(257);let o=a.env.NEXT_PUBLIC_SUPABASE_URL||"",c=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",i=()=>!!(o&&c),d=null,s=()=>i()?(d||(d=(0,n.eI)(o,c)),d):(console.warn("⚠️ Supabase credentials not configured. Using mock data."),null),u=new Proxy({},{get(e,t){let r=s();if(!r)throw Error("Supabase not configured");return r[t]}})},9397:function(e,t,r){r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])}}]);