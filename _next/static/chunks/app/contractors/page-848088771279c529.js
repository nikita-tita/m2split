(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[480],{6655:function(e,a,t){Promise.resolve().then(t.bind(t,8586))},8586:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return k}});var n=t(7437),s=t(2265),l=t(824),i=t(9178),r=t(4226),c=t(8068),d=t(9379),o=t(2489);function m(e){let{isOpen:a,onClose:t,title:s,children:l}=e;return a?(0,n.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,n.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,n.jsx)("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:t}),(0,n.jsx)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full",children:(0,n.jsxs)("div",{className:"bg-white px-6 pt-5 pb-4",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:s}),(0,n.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-500",children:(0,n.jsx)(o.Z,{className:"w-6 h-6"})})]}),l]})})]})}):null}var h=t(5930),p=t(9397),x=t(1817),u=t(1671),j=t(5868),b=t(1384),N=t(9057),v=t(8509),y=t(3702),g=t(8332),f=t(2097);function k(){let{currentRole:e}=(0,f.o)(),[a,t]=(0,s.useState)([]),[o,k]=(0,s.useState)(!0),[C,E]=(0,s.useState)(!1),[w,T]=(0,s.useState)(!1),[A,R]=(0,s.useState)(null),[O,I]=(0,s.useState)({type:"AGENT",name:"",inn:"",kpp:"",accountNumber:"",bik:"",bankName:"",email:"",phone:""});(0,s.useEffect)(()=>{Z()},[]);let Z=async()=>{try{k(!0);let e=await N.f.getCounterparties();t(e)}catch(e){console.error("Failed to load contractors:",e)}finally{k(!1)}},z=e=>{R(e.id),I({type:e.type,name:e.name,inn:e.inn,kpp:e.kpp||"",accountNumber:e.accountNumber||"",bik:e.bik||"",bankName:e.bankName||"",email:e.email||"",phone:e.phone||""}),T(!0)},P=async a=>{a.preventDefault(),E(!0);try{let a;let t={type:O.type,name:O.name,inn:O.inn,kpp:O.kpp||void 0,accountNumber:O.accountNumber||void 0,bik:O.bik||void 0,bankName:O.bankName||void 0,email:O.email||void 0,phone:O.phone||void 0};A?(await N.f.updateCounterparty(A,t),a=A,await v.W.logEvent({type:"CONTRACTOR_UPDATED",entityType:"CONTRACTOR",entityId:a,userId:"2",userName:"Current User",userRole:e,description:"Контрагент обновлён: ".concat(O.name),metadata:{name:O.name,inn:O.inn,type:O.type}})):(a=(await N.f.createCounterparty(t)).id,await v.W.logEvent({type:"CONTRACTOR_CREATED",entityType:"CONTRACTOR",entityId:a,userId:"2",userName:"Current User",userRole:e,description:"Контрагент создан: ".concat(O.name),metadata:{name:O.name,inn:O.inn,type:O.type}})),await Z(),T(!1)}catch(e){console.error("Failed to save contractor:",e),alert("Не удалось сохранить контрагента")}finally{E(!1)}},D=async t=>{try{let n=a.find(e=>e.id===t);await N.f.acceptOffer(t),n&&await v.W.logEvent({type:"CONTRACTOR_OFFER_ACCEPTED",entityType:"CONTRACTOR",entityId:t,userId:"2",userName:"Current User",userRole:e,description:"Оферта принята: ".concat(n.name),metadata:{name:n.name,inn:n.inn,type:n.type}}),await Z()}catch(e){console.error("Failed to accept offer:",e),alert("Не удалось принять оферту")}},S=e=>(0,n.jsx)(d.C,{variant:"info",size:"sm",children:{DEVELOPER:"Застройщик",AGENCY:"АН",AGENT:"Агент",IP:"ИП",NPD:"НПД"}[e]});return(0,n.jsx)(l.A,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Контрагенты"}),(0,n.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Управление контрагентами и статусами оферт"})]}),(0,n.jsxs)(r.z,{onClick:()=>{R(null),I({type:"AGENT",name:"",inn:"",kpp:"",accountNumber:"",bik:"",bankName:"",email:"",phone:""}),T(!0)},children:[(0,n.jsx)(p.Z,{className:"w-5 h-5 mr-2"}),"Добавить контрагента"]})]}),(0,n.jsx)(y.E,{...g.p.contractors}),(0,n.jsx)(i.Z,{padding:"none",children:o?(0,n.jsxs)("div",{className:"text-center py-12",children:[(0,n.jsx)(x.Z,{className:"w-8 h-8 animate-spin mx-auto text-gray-400"}),(0,n.jsx)("p",{className:"text-gray-500 mt-4",children:"Загрузка контрагентов..."})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(h.iA,{children:[(0,n.jsx)(h.xD,{children:(0,n.jsxs)(h.SC,{children:[(0,n.jsx)(h.pj,{header:!0,children:"Тип"}),(0,n.jsx)(h.pj,{header:!0,children:"Название"}),(0,n.jsx)(h.pj,{header:!0,children:"ИНН / КПП"}),(0,n.jsx)(h.pj,{header:!0,children:"Реквизиты"}),(0,n.jsx)(h.pj,{header:!0,children:"Оферта"}),(0,n.jsx)(h.pj,{header:!0,children:"Дата создания"}),(0,n.jsx)(h.pj,{header:!0,children:" "})]})}),(0,n.jsx)(h.RM,{children:a.map(e=>(0,n.jsxs)(h.SC,{children:[(0,n.jsx)(h.pj,{children:S(e.type)}),(0,n.jsx)(h.pj,{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-medium",children:e.name}),e.email&&(0,n.jsx)("div",{className:"text-xs text-gray-500",children:e.email})]})}),(0,n.jsx)(h.pj,{children:(0,n.jsxs)("div",{className:"font-mono text-xs",children:[(0,n.jsxs)("div",{children:["ИНН: ",e.inn]}),e.kpp&&(0,n.jsxs)("div",{children:["КПП: ",e.kpp]})]})}),(0,n.jsx)(h.pj,{children:(0,n.jsxs)("div",{className:"text-xs",children:[e.accountNumber&&(0,n.jsxs)("div",{children:["Р/С: ",e.accountNumber]}),e.bik&&(0,n.jsxs)("div",{children:["БИК: ",e.bik]}),e.bankName&&(0,n.jsx)("div",{className:"text-gray-500",children:e.bankName})]})}),(0,n.jsx)(h.pj,{children:e.offerAcceptedAt?(0,n.jsxs)("div",{className:"flex items-center gap-1 text-sm text-green-600",children:[(0,n.jsx)(u.Z,{className:"w-4 h-4"}),"Принята"]}):(0,n.jsx)(r.z,{variant:"ghost",size:"sm",onClick:()=>D(e.id),children:"Принять оферту"})}),(0,n.jsx)(h.pj,{className:"text-xs text-gray-500",children:(0,b.o0)(e.createdAt)}),(0,n.jsx)(h.pj,{children:(0,n.jsx)("div",{className:"flex gap-2",children:(0,n.jsx)(r.z,{variant:"ghost",size:"sm",onClick:()=>z(e),children:(0,n.jsx)(j.Z,{className:"w-4 h-4"})})})})]},e.id))})]}),0===a.length&&!o&&(0,n.jsx)("div",{className:"text-center py-12",children:(0,n.jsx)("p",{className:"text-gray-500",children:"Пока нет контрагентов. Добавьте первого!"})})]})}),(0,n.jsx)(m,{isOpen:w,onClose:()=>T(!1),title:A?"Редактировать контрагента":"Новый контрагент",children:(0,n.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[(0,n.jsx)(c.P,{label:"Тип контрагента",value:O.type,onChange:e=>I({...O,type:e.target.value}),options:[{value:"DEVELOPER",label:"Застройщик"},{value:"AGENCY",label:"Агентство недвижимости"},{value:"AGENT",label:"Агент (физлицо)"},{value:"IP",label:"Индивидуальный предприниматель"},{value:"NPD",label:"Самозанятый (НПД)"}],required:!0,disabled:C}),(0,n.jsx)(c.I,{label:"Название / ФИО",placeholder:"ООО Компания или Иванов Иван Иванович",value:O.name,onChange:e=>I({...O,name:e.target.value}),required:!0,disabled:C}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsx)(c.I,{label:"ИНН",placeholder:"1234567890",value:O.inn,onChange:e=>I({...O,inn:e.target.value}),required:!0,disabled:C}),(0,n.jsx)(c.I,{label:"КПП",placeholder:"123456789",value:O.kpp,onChange:e=>I({...O,kpp:e.target.value}),disabled:C})]}),(0,n.jsx)(c.I,{label:"Расчётный счёт",placeholder:"40702810...",value:O.accountNumber,onChange:e=>I({...O,accountNumber:e.target.value}),disabled:C}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsx)(c.I,{label:"БИК банка",placeholder:"044525225",value:O.bik,onChange:e=>I({...O,bik:e.target.value}),disabled:C}),(0,n.jsx)(c.I,{label:"Название банка",placeholder:"ПАО Сбербанк",value:O.bankName,onChange:e=>I({...O,bankName:e.target.value}),disabled:C})]}),(0,n.jsx)(c.I,{label:"Email",type:"email",placeholder:"email@example.com",value:O.email,onChange:e=>I({...O,email:e.target.value}),disabled:C}),(0,n.jsx)(c.I,{label:"Телефон",type:"tel",placeholder:"+7 (999) 123-45-67",value:O.phone,onChange:e=>I({...O,phone:e.target.value}),disabled:C}),(0,n.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,n.jsx)(r.z,{type:"button",variant:"secondary",onClick:()=>T(!1),disabled:C,children:"Отмена"}),(0,n.jsx)(r.z,{type:"submit",disabled:C,children:C?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(x.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Сохранение..."]}):A?"Сохранить":"Создать"})]})]})})]})})}},1671:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});let n=(0,t(9205).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1817:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});let n=(0,t(9205).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5868:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});let n=(0,t(9205).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])}},function(e){e.O(0,[211,545,990,514,790,971,117,744],function(){return e(e.s=6655)}),_N_E=e.O()}]);