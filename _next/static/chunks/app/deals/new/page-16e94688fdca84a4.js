(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[657],{3422:function(e,t,a){Promise.resolve().then(a.bind(a,3932))},3932:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return E}});var r=a(7437),n=a(2265),o=a(824),c=a(9178),s=a(4226),i=a(8068),l=a(9379),d=a(5930),u=a(2660);let m=(0,a(9205).Z)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var p=a(9397),f=a(8930),h=a(2097),g=a(3694),v=a(1384),x=a(9057),y=a(2141);let j=[{id:"prj-kvartal-domashniy",developerId:"dev-samolot",projectName:"ЖК \xabКвартал Домашний\xbb",region:"Москва",city:"Москва",address:"ул. Донецкая",isActive:!0,createdAt:new Date,updatedAt:new Date},{id:"prj-soyuz",developerId:"dev-rodina",projectName:"ЖК \xabСОЮЗ\xbb",region:"Москва",city:"Москва",address:"ул. Сельскохозяйственная",isActive:!0,createdAt:new Date,updatedAt:new Date}];class b{async getProjects(e){if(!(0,y.jv)())return console.warn("\uD83D\uDCE6 Using mock data (Supabase not configured)"),j;try{let t=y.OQ.from("projects").select("*").order("project_name",{ascending:!0});(null==e?void 0:e.developerId)&&(t=t.eq("developer_id",e.developerId)),(null==e?void 0:e.city)&&(t=t.eq("city",e.city)),(null==e?void 0:e.isActive)!==void 0&&(t=t.eq("is_active",e.isActive));let{data:a,error:r}=await t;if(r)throw r;return(a||[]).map(this.transformFromDB)}catch(e){throw console.error("Error fetching projects:",e),e}}async getProject(e){if(!(0,y.jv)())return j.find(t=>t.id===e)||null;try{let{data:t,error:a}=await y.OQ.from("projects").select("*").eq("id",e).single();if(a)throw a;if(!t)return null;return this.transformFromDB(t)}catch(e){return console.error("Error fetching project:",e),null}}transformFromDB(e){return{id:e.id,developerId:e.developer_id,projectName:e.project_name,region:e.region,city:e.city,address:e.address,description:e.description,isActive:e.is_active,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}}let N=new b,A=[{id:"tariff-1",tariffId:"TAR-SAMOLET-BASE",developerId:"dev-samolet",developerName:"Группа \xabСамолет\xbb",developerLegalEntity:"ООО \xabСамолет\xbb",projectId:"prj-kvartal-domashniy",projectName:"ЖК \xabКвартал Домашний\xbb",region:"Москва",city:"Москва",segment:"FLATS",objectCategory:"1_ROOM",paymentStage:"ADVANCE",commissionSchemeType:"PERCENT_OF_CONTRACT",commissionTotalPercent:2.7,promoFlag:"BASE",validFrom:new Date("2025-01-01"),validTo:new Date("2025-11-30"),isActive:!0,createdAt:new Date,updatedAt:new Date}];class w{async getTariffs(e){if(!(0,y.jv)())return console.log("Using mock tariffs"),A.filter(t=>(null==e||!e.developerId||t.developerId===e.developerId)&&(null==e||!e.projectId||t.projectId===e.projectId)&&(null==e||!e.segment||t.segment===e.segment)&&(null==e||!e.objectCategory||t.objectCategory===e.objectCategory)&&(null==e||!e.paymentStage||t.paymentStage===e.paymentStage)&&((null==e?void 0:e.isActive)===void 0||t.isActive===e.isActive));let t=y.OQ.from("tariffs").select("*").order("valid_from",{ascending:!1});(null==e?void 0:e.developerId)&&(t=t.eq("developer_id",e.developerId)),(null==e?void 0:e.projectId)&&(t=t.eq("project_id",e.projectId)),(null==e?void 0:e.segment)&&(t=t.eq("segment",e.segment)),(null==e?void 0:e.objectCategory)&&(t=t.eq("object_category",e.objectCategory)),(null==e?void 0:e.paymentStage)&&(t=t.eq("payment_stage",e.paymentStage)),(null==e?void 0:e.isActive)!==void 0&&(t=t.eq("is_active",e.isActive));let{data:a,error:r}=await t;if(r)throw console.error("Error fetching tariffs:",r),r;return this.mapToTariffs(a||[])}async getTariff(e){if(!(0,y.jv)())return A.find(t=>t.id===e)||null;let{data:t,error:a}=await y.OQ.from("tariffs").select("*").eq("id",e).single();return a?(console.error("Error fetching tariff:",a),null):t?this.mapToTariff(t):null}async findBestTariff(e){let t={projectId:e.projectId,isActive:!0};e.developerId&&(t.developerId=e.developerId),e.segment&&(t.segment=e.segment),e.objectCategory&&(t.objectCategory=e.objectCategory);let a=await this.getTariffs(t);return 0===a.length?null:a.sort((e,t)=>{let a=e.commissionTotalPercent||0;return(t.commissionTotalPercent||0)-a})[0]}calculateCommission(e,t){if("PERCENT_OF_CONTRACT"===t.commissionSchemeType){let a=e*(t.commissionTotalPercent||0)/100;return t.commissionMinAmount&&a<t.commissionMinAmount&&(a=t.commissionMinAmount),t.commissionMaxAmount&&a>t.commissionMaxAmount&&(a=t.commissionMaxAmount),a}return"FIXED_AMOUNT"===t.commissionSchemeType&&t.commissionFixedAmount||0}getTariffDisplayInfo(e){return"PERCENT_OF_CONTRACT"===e.commissionSchemeType?"".concat(e.commissionTotalPercent,"% (максимальный тариф)"):"FIXED_AMOUNT"===e.commissionSchemeType?"".concat(e.commissionFixedAmount," ₽ (фикс.)"):"Ступенчатая шкала"}mapToTariff(e){return{id:e.id,tariffId:e.tariff_id,developerId:e.developer_id,developerName:e.developer_name,developerLegalEntity:e.developer_legal_entity,projectId:e.project_id,projectName:e.project_name,region:e.region,city:e.city,segment:e.segment,objectCategory:e.object_category,paymentStage:e.payment_stage,commissionSchemeType:e.commission_scheme_type,commissionTotalPercent:e.commission_total_percent,commissionFixedAmount:e.commission_fixed_amount,commissionMinAmount:e.commission_min_amount,commissionMaxAmount:e.commission_max_amount,promoFlag:e.promo_flag,promoDescription:e.promo_description,validFrom:new Date(e.valid_from),validTo:e.valid_to?new Date(e.valid_to):void 0,isActive:e.is_active,comments:e.comments,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}mapToTariffs(e){return e.map(e=>this.mapToTariff(e))}}let D=new w;var I=a(7648),_=a(9376);function E(){let e=(0,_.useRouter)(),{addDeal:t}=(0,h.o)(),[a,y]=(0,n.useState)([]),[j,b]=(0,n.useState)([]),[A,w]=(0,n.useState)(""),[E,C]=(0,n.useState)(""),[S,T]=(0,n.useState)([]),[P,R]=(0,n.useState)(""),[k,O]=(0,n.useState)(""),[F,M]=(0,n.useState)(""),[B,G]=(0,n.useState)(""),[q,U]=(0,n.useState)(""),[z,L]=(0,n.useState)(""),[Z,Q]=(0,n.useState)(""),[Y,V]=(0,n.useState)(""),[X,K]=(0,n.useState)(""),[W,H]=(0,n.useState)(null),[$,J]=(0,n.useState)(0),[ee,et]=(0,n.useState)([]);(0,n.useEffect)(()=>{ea()},[]),(0,n.useEffect)(()=>{A?T(j.filter(e=>e.developerId===A)):T([]),C(""),R(""),O("")},[A,j]),(0,n.useEffect)(()=>{if(E){let e=j.find(e=>e.id===E);e&&(R(e.projectName),O(e.address||"".concat(e.city,", ").concat(e.region)))}},[E,j]),(0,n.useEffect)(()=>{(async()=>{if(E&&A)try{let e=await D.findBestTariff({developerId:A,projectId:E});if(H(e),e&&B){let t=D.calculateCommission(parseFloat(B),e);J(t)}else J(0)}catch(e){console.error("Failed to find tariff:",e),H(null),J(0)}else H(null),J(0)})()},[E,A,B]),(0,n.useEffect)(()=>{$>0&&ee.length>0&&et(e=>e.map(e=>({...e,amount:$*e.sharePercent/100})))},[$]);let ea=async()=>{try{let e=await x.f.getCounterparties({type:"DEVELOPER",offerAccepted:!0});y(e);let t=await N.getProjects({city:"Москва",isActive:!0});b(t)}catch(e){console.error("Failed to load developers/projects:",e)}},er=e=>{et(ee.filter((t,a)=>a!==e))},en=(e,t,a)=>{let r=[...ee];r[e]={...r[e],[t]:a},"taxRegime"===t&&"OSN"===a?r[e].vatRate=20:"taxRegime"===t&&"OSN"!==a&&(r[e].vatRate=void 0),"sharePercent"===t&&$>0&&(r[e].amount=$*a/100),et(r)},eo=ee.reduce((e,t)=>e+t.sharePercent,0),ec=.01>Math.abs(eo-100),es=P&&k&&B&&ee.length>0&&ec;return(0,r.jsx)(o.A,{children:(0,r.jsxs)("form",{onSubmit:a=>{if(a.preventDefault(),!es)return;let r="d".concat(Date.now()),n=parseFloat(B),o=ee.map((e,t)=>{let a=g.dp.find(t=>t.id===e.contractorId);return{id:"s".concat(r,"_").concat(t),contractorId:e.contractorId,contractor:a,role:e.role,sharePercent:e.sharePercent,amount:e.amount,taxRegime:e.taxRegime,vatRate:e.vatRate,contractNumber:e.contractNumber||void 0,contractDate:e.contractDate?new Date(e.contractDate):void 0}});t({id:r,objectName:P,objectAddress:k,lotNumber:F||void 0,developerId:A||void 0,projectId:E||void 0,totalAmount:n,status:"DRAFT",shares:o,contractNumber:q||void 0,contractDate:z?new Date(z):void 0,clientName:Z||void 0,clientPhone:Y||void 0,clientEmail:X||void 0,tariffId:null==W?void 0:W.id,commissionCalculatedAmount:$||void 0,commissionActualAmount:$||void 0,responsibleUserId:"2",initiator:{role:"M2_OPERATOR",partyId:"1",userId:"2",timestamp:new Date},createdAt:new Date,updatedAt:new Date}),e.push("/deals/".concat(r))},className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(I.default,{href:"/deals",children:(0,r.jsx)(s.z,{type:"button",variant:"ghost",size:"sm",children:(0,r.jsx)(u.Z,{className:"w-5 h-5"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Создание сделки"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Укажите объект и распределите доли между участниками"}),(0,r.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-sm text-blue-600",children:[(0,r.jsx)(m,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Система работает только для объектов в Москве"})]})]})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(I.default,{href:"/deals",children:(0,r.jsx)(s.z,{type:"button",variant:"secondary",children:"Отмена"})}),(0,r.jsx)(s.z,{type:"submit",disabled:!es,children:"Создать сделку"})]})]}),(0,r.jsxs)(c.Z,{children:[(0,r.jsx)(c.O,{title:"Основная информация"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(i.P,{label:"Застройщик",value:A,onChange:e=>w(e.target.value),options:[{value:"",label:"Выберите застройщика"},...a.map(e=>({value:e.id,label:e.name}))],required:!0}),(0,r.jsx)(i.P,{label:"Проект / ЖК",value:E,onChange:e=>C(e.target.value),options:[{value:"",label:A?"Выберите проект":"Сначала выберите застройщика"},...S.map(e=>({value:e.id,label:e.projectName}))],required:!0,disabled:!A})]}),(0,r.jsx)(i.I,{label:"Название объекта",placeholder:"ЖК Солнечный",value:P,onChange:e=>R(e.target.value),required:!0,disabled:!E}),(0,r.jsx)(i.I,{label:"Адрес объекта",placeholder:"г. Москва, ул. Солнечная, д. 10",value:k,onChange:e=>O(e.target.value),required:!0,disabled:!E}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(i.I,{label:"Лот (квартира, офис)",placeholder:"Кв. 45",value:F,onChange:e=>M(e.target.value)}),(0,r.jsx)(i.I,{label:"Сумма договора с застройщиком (₽)",type:"number",placeholder:"15000000",value:B,onChange:e=>G(e.target.value),required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(i.I,{label:"Номер договора",placeholder:"ДК-2024-001",value:q,onChange:e=>U(e.target.value)}),(0,r.jsx)(i.I,{label:"Дата договора",type:"date",value:z,onChange:e=>L(e.target.value)})]}),W&&B&&(0,r.jsxs)("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Расчет комиссии КВН"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Тариф:"}),(0,r.jsx)("span",{className:"font-medium text-gray-900",children:D.getTariffDisplayInfo(W)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Сумма договора:"}),(0,r.jsx)("span",{className:"font-medium text-gray-900",children:(0,v.xG)(parseFloat(B))})]}),(0,r.jsxs)("div",{className:"flex justify-between pt-2 border-t border-blue-200",children:[(0,r.jsx)("span",{className:"font-semibold text-blue-900",children:"Комиссия КВН:"}),(0,r.jsx)("span",{className:"font-bold text-blue-900",children:(0,v.xG)($)})]}),(0,r.jsx)("p",{className:"text-xs text-blue-700 mt-2",children:"* Расчет на основе уникального клиента (максимальный тариф)"})]})]})]})]}),(0,r.jsxs)(c.Z,{children:[(0,r.jsx)(c.O,{title:"Информация о клиенте"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"На кого бронируем объект"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(i.I,{label:"ФИО клиента",placeholder:"Иванов Иван Иванович",value:Z,onChange:e=>Q(e.target.value)}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(i.I,{label:"Телефон",type:"tel",placeholder:"+7 (999) 123-45-67",value:Y,onChange:e=>V(e.target.value)}),(0,r.jsx)(i.I,{label:"Email",type:"email",placeholder:"client@example.com",value:X,onChange:e=>K(e.target.value)})]})]})]}),(0,r.jsxs)(c.Z,{padding:"none",children:[(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(c.O,{title:"Распределение долей"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Сумма долей: ",eo.toFixed(2),"%"," ",ec?(0,r.jsx)(l.C,{variant:"success",size:"sm",children:"✓ Корректно"}):(0,r.jsx)(l.C,{variant:"danger",size:"sm",children:"Должно быть 100%"})]})]}),(0,r.jsxs)(s.z,{type:"button",variant:"secondary",size:"sm",onClick:()=>{et([...ee,{contractorId:"",role:"AGENT",sharePercent:0,amount:0,taxRegime:"USN",contractNumber:"",contractDate:""}])},children:[(0,r.jsx)(p.Z,{className:"w-4 h-4 mr-2"}),"Добавить получателя"]})]})}),ee.length>0&&(0,r.jsxs)(d.iA,{children:[(0,r.jsx)(d.xD,{children:(0,r.jsxs)(d.SC,{children:[(0,r.jsx)(d.pj,{header:!0,children:"Контрагент"}),(0,r.jsx)(d.pj,{header:!0,children:"Роль"}),(0,r.jsx)(d.pj,{header:!0,children:"Доля %"}),(0,r.jsx)(d.pj,{header:!0,children:"Сумма"}),(0,r.jsx)(d.pj,{header:!0,children:"Режим"}),(0,r.jsx)(d.pj,{header:!0,children:"НДС %"}),(0,r.jsx)(d.pj,{header:!0,children:"Договор"}),(0,r.jsx)(d.pj,{header:!0,children:" "})]})}),(0,r.jsx)(d.RM,{children:ee.map((e,t)=>{var a;return(0,r.jsxs)(d.SC,{children:[(0,r.jsx)(d.pj,{children:(0,r.jsx)(i.P,{value:e.contractorId,onChange:e=>en(t,"contractorId",e.target.value),options:[{value:"",label:"Выберите контрагента"},...g.dp.map(e=>({value:e.id,label:"".concat(e.name," (").concat(e.inn,")")}))]})}),(0,r.jsx)(d.pj,{children:(0,r.jsx)(i.P,{value:e.role,onChange:e=>en(t,"role",e.target.value),options:[{value:"AGENCY",label:"АН"},{value:"AGENT",label:"Агент"},{value:"IP",label:"ИП"},{value:"NPD",label:"НПД"}]})}),(0,r.jsx)(d.pj,{children:(0,r.jsx)(i.I,{type:"number",step:"0.01",min:"0",max:"100",value:e.sharePercent||"",onChange:e=>en(t,"sharePercent",parseFloat(e.target.value)||0)})}),(0,r.jsx)(d.pj,{className:"font-medium",children:$>0&&e.amount>0?(0,v.xG)(e.amount):"—"}),(0,r.jsx)(d.pj,{children:(0,r.jsx)(i.P,{value:e.taxRegime,onChange:e=>en(t,"taxRegime",e.target.value),options:[{value:"OSN",label:"НДС"},{value:"USN",label:"УСН"},{value:"NPD",label:"НПД"}]})}),(0,r.jsx)(d.pj,{children:"OSN"===e.taxRegime?(0,r.jsx)(i.P,{value:(null===(a=e.vatRate)||void 0===a?void 0:a.toString())||"20",onChange:e=>en(t,"vatRate",parseInt(e.target.value)),options:[{value:"0",label:"0%"},{value:"10",label:"10%"},{value:"20",label:"20%"}]}):"—"}),(0,r.jsx)(d.pj,{children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i.I,{placeholder:"№ договора",value:e.contractNumber,onChange:e=>en(t,"contractNumber",e.target.value)}),(0,r.jsx)(i.I,{type:"date",value:e.contractDate,onChange:e=>en(t,"contractDate",e.target.value)})]})}),(0,r.jsx)(d.pj,{children:(0,r.jsx)(s.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>er(t),children:(0,r.jsx)(f.Z,{className:"w-4 h-4 text-red-600"})})})]},t)})})]}),0===ee.length&&(0,r.jsx)("div",{className:"text-center py-12 border-t",children:(0,r.jsx)("p",{className:"text-gray-500",children:"Нажмите “Добавить получателя” для распределения долей"})})]})]})})}},9379:function(e,t,a){"use strict";a.d(t,{C:function(){return o}});var r=a(7437);a(2265);var n=a(1994);let o=e=>{let{children:t,variant:a="default",size:o="md"}=e;return(0,r.jsx)("span",{className:(0,n.W)("inline-flex items-center rounded-full font-medium",{default:"bg-gray-100 text-gray-800",success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",danger:"bg-red-100 text-red-800",info:"bg-blue-100 text-blue-800"}[a],{sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-1 text-sm"}[o]),children:t})}},4226:function(e,t,a){"use strict";a.d(t,{z:function(){return o}});var r=a(7437);a(2265);var n=a(1994);let o=e=>{let{variant:t="primary",size:a="md",className:o,children:c,disabled:s,...i}=e;return(0,r.jsx)("button",{className:(0,n.W)("inline-flex items-center justify-center rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"bg-transparent text-gray-700 hover:bg-gray-100 focus:ring-gray-500"}[t],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[a],o),disabled:s,...i,children:c})}},8068:function(e,t,a){"use strict";a.d(t,{I:function(){return o},P:function(){return c}});var r=a(7437);a(2265);var n=a(1994);let o=e=>{let{label:t,error:a,helperText:o,className:c,...s}=e;return(0,r.jsxs)("div",{className:"w-full",children:[t&&(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),(0,r.jsx)("input",{className:(0,n.W)("w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",a?"border-red-300":"border-gray-300",c),...s}),a&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:a}),o&&!a&&(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o})]})},c=e=>{let{label:t,error:a,options:o,className:c,...s}=e;return(0,r.jsxs)("div",{className:"w-full",children:[t&&(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),(0,r.jsx)("select",{className:(0,n.W)("w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",a?"border-red-300":"border-gray-300",c),...s,children:o.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))}),a&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:a})]})}},3694:function(e,t,a){"use strict";a.d(t,{G:function(){return o},L$:function(){return i},bs:function(){return r},dp:function(){return n},kG:function(){return s},nh:function(){return c}});let r=[{id:"1",email:"admin@developer.ru",name:"Иван Застройщиков",role:"DEVELOPER_ADMIN",createdAt:new Date("2024-01-01")},{id:"2",email:"operator@m2split.ru",name:"Мария Операторова",role:"M2_OPERATOR",createdAt:new Date("2024-01-01")},{id:"3",email:"agency@realty.ru",name:'АН "Недвижимость+"',role:"CONTRACTOR",createdAt:new Date("2024-01-15")}],n=[{id:"c1",type:"AGENCY",name:'АН "Недвижимость Плюс"',inn:"7701234567",kpp:"770101001",accountNumber:"40702810100000001234",bik:"044525225",bankName:"ПАО Сбербанк",address:"г. Москва, ул. Примерная, д. 1",offerAcceptedAt:new Date("2024-02-01"),offerAcceptanceChannel:"email",createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-02-01")},{id:"c2",type:"AGENT",name:"Петров Петр Петрович",inn:"771234567890",accountNumber:"40817810200000002345",bik:"044525225",bankName:"ПАО Сбербанк",address:"г. Москва, ул. Агентская, д. 2",offerAcceptedAt:new Date("2024-02-05"),offerAcceptanceChannel:"web",createdAt:new Date("2024-01-20"),updatedAt:new Date("2024-02-05")},{id:"c3",type:"NPD",name:"Сидорова Анна Ивановна",inn:"123456789012",accountNumber:"40817810300000003456",bik:"044525974",bankName:"ПАО ВТБ",address:"г. Санкт-Петербург, пр. Невский, д. 100",offerAcceptedAt:new Date("2024-02-10"),offerAcceptanceChannel:"mobile",createdAt:new Date("2024-01-25"),updatedAt:new Date("2024-02-10")}],o=[{id:"d1",objectName:'ЖК "Солнечный"',objectAddress:"г. Москва, ул. Солнечная, д. 10, корп. 1",lotNumber:"Кв. 45",developerId:"1",totalAmount:15e6,status:"IN_PROGRESS",shares:[{id:"s1",contractorId:"c1",contractor:n[0],role:"AGENCY",sharePercent:60,amount:9e6,taxRegime:"OSN",vatRate:20,contractNumber:"АГ-001/2024",contractDate:new Date("2024-02-01")},{id:"s2",contractorId:"c2",contractor:n[1],role:"AGENT",sharePercent:30,amount:45e5,taxRegime:"USN",contractNumber:"АГ-002/2024",contractDate:new Date("2024-02-05")},{id:"s3",contractorId:"c3",contractor:n[2],role:"NPD",sharePercent:10,amount:15e5,taxRegime:"NPD",contractNumber:"АГ-003/2024",contractDate:new Date("2024-02-10")}],contractBasis:"Договор комиссии",contractNumber:"ДК-2024-001",contractDate:new Date("2024-02-01"),specialAccountReceiptDate:new Date("2024-02-15"),responsibleUserId:"2",initiator:{role:"M2_OPERATOR",partyId:"1",userId:"2",timestamp:new Date("2024-02-01")},createdAt:new Date("2024-02-01"),updatedAt:new Date("2024-02-15")},{id:"d2",objectName:'ЖК "Морской бриз"',objectAddress:"г. Санкт-Петербург, наб. Морская, д. 5",lotNumber:"Кв. 102",developerId:"1",totalAmount:22e6,status:"DRAFT",shares:[{id:"s4",contractorId:"c1",contractor:n[0],role:"AGENCY",sharePercent:70,amount:154e5,taxRegime:"OSN",vatRate:20},{id:"s5",contractorId:"c2",contractor:n[1],role:"AGENT",sharePercent:30,amount:66e5,taxRegime:"USN"}],responsibleUserId:"2",initiator:{role:"AGENCY_ADMIN",partyId:"c1",userId:"3",timestamp:new Date("2024-03-01")},createdAt:new Date("2024-03-01"),updatedAt:new Date("2024-03-01")}],c=[{id:"r1",registryNumber:"РЕЕ-2024-001",date:new Date("2024-03-15"),status:"APPROVED",totalAmount:15e6,linesCount:3,creatorId:"2",approverId:"1",approvedAt:new Date("2024-03-16"),lines:[{id:"l1",registryId:"r1",contractorId:"c1",contractor:n[0],role:"AGENCY",inn:"7701234567",accountNumber:"40702810100000001234",bik:"044525225",amount:9e6,taxRegime:"OSN",vatRate:20,contractNumber:"АГ-001/2024",contractDate:new Date("2024-02-01"),comment:"Комиссия за сделку ЖК Солнечный кв.45",paymentStatus:"PENDING",createdAt:new Date("2024-03-15"),updatedAt:new Date("2024-03-15")},{id:"l2",registryId:"r1",contractorId:"c2",contractor:n[1],role:"AGENT",inn:"771234567890",accountNumber:"40817810200000002345",bik:"044525225",amount:45e5,taxRegime:"USN",contractNumber:"АГ-002/2024",contractDate:new Date("2024-02-05"),comment:"Агентское вознаграждение",paymentStatus:"PENDING",createdAt:new Date("2024-03-15"),updatedAt:new Date("2024-03-15")},{id:"l3",registryId:"r1",contractorId:"c3",contractor:n[2],role:"NPD",inn:"123456789012",accountNumber:"40817810300000003456",bik:"044525974",amount:15e5,taxRegime:"NPD",contractNumber:"АГ-003/2024",contractDate:new Date("2024-02-10"),comment:"Услуги самозанятого",paymentStatus:"PENDING",createdAt:new Date("2024-03-15"),updatedAt:new Date("2024-03-15")}],createdAt:new Date("2024-03-15"),updatedAt:new Date("2024-03-16")}],s=[{id:"p1",registryId:"r1",lineId:"l1",contractorId:"c1",amount:9e6,status:"EXECUTED",bankReference:"BNK-2024-001",executedAt:new Date("2024-03-17"),createdAt:new Date("2024-03-16"),updatedAt:new Date("2024-03-17")},{id:"p2",registryId:"r1",lineId:"l2",contractorId:"c2",amount:45e5,status:"ACCEPTED_BY_BANK",bankReference:"BNK-2024-002",createdAt:new Date("2024-03-16"),updatedAt:new Date("2024-03-16")},{id:"p3",registryId:"r1",lineId:"l3",contractorId:"c3",amount:15e5,status:"ERROR",bankErrorCode:"ERR-01",bankErrorText:"Неверный номер счёта получателя",createdAt:new Date("2024-03-16"),updatedAt:new Date("2024-03-16")}],i={specialAccountBalance:37e6,paidThisPeriod:9e6,pendingPayments:6e6,errorPayments:15e5,primaryDocCompletion:33.33,vatSavings:18e5}},9057:function(e,t,a){"use strict";a.d(t,{f:function(){return c}});var r=a(2141),n=a(3694);class o{async getCounterparties(e){if(!(0,r.jv)())return console.warn("\uD83D\uDCE6 Using mock data (Supabase not configured)"),n.dp;try{let t=r.OQ.from("counterparties").select("*").order("created_at",{ascending:!1});(null==e?void 0:e.type)&&(t=t.eq("type",e.type)),(null==e?void 0:e.offerAccepted)!==void 0&&(t=e.offerAccepted?t.not("offer_accepted_at","is",null):t.is("offer_accepted_at",null));let{data:a,error:n}=await t;if(n)throw n;return(a||[]).map(this.transformFromDB)}catch(e){throw console.error("Error fetching counterparties:",e),e}}async getCounterparty(e){if(!(0,r.jv)())return n.dp.find(t=>t.id===e)||null;try{let{data:t,error:a}=await r.OQ.from("counterparties").select("*").eq("id",e).single();if(a)throw a;if(!t)return null;return this.transformFromDB(t)}catch(e){return console.error("Error fetching counterparty:",e),null}}async createCounterparty(e){if(!(0,r.jv)())throw Error("Supabase not configured");try{let{data:t,error:a}=await r.OQ.from("counterparties").insert({type:e.type,name:e.name,inn:e.inn,kpp:e.kpp,account_number:e.accountNumber,bik:e.bik,bank_name:e.bankName,email:e.email,phone:e.phone}).select().single();if(a)throw a;if(!t)throw Error("Failed to create counterparty");return this.transformFromDB(t)}catch(e){throw console.error("Error creating counterparty:",e),e}}async updateCounterparty(e,t){if(!(0,r.jv)())throw Error("Supabase not configured");try{let{data:a,error:n}=await r.OQ.from("counterparties").update({type:t.type,name:t.name,inn:t.inn,kpp:t.kpp,account_number:t.accountNumber,bik:t.bik,bank_name:t.bankName,email:t.email,phone:t.phone}).eq("id",e).select().single();if(n)throw n;if(!a)throw Error("Counterparty not found");return this.transformFromDB(a)}catch(e){throw console.error("Error updating counterparty:",e),e}}async acceptOffer(e){if(!(0,r.jv)())throw Error("Supabase not configured");try{let{data:t,error:a}=await r.OQ.from("counterparties").update({offer_accepted_at:new Date().toISOString()}).eq("id",e).select().single();if(a)throw a;if(!t)throw Error("Counterparty not found");return this.transformFromDB(t)}catch(e){throw console.error("Error accepting offer:",e),e}}transformFromDB(e){return{id:e.id,name:e.name,inn:e.inn,type:e.type,kpp:e.kpp,accountNumber:e.account_number,bik:e.bik,bankName:e.bank_name,email:e.email,phone:e.phone,offerAcceptedAt:e.offer_accepted_at?new Date(e.offer_accepted_at):void 0,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}}let c=new o},2141:function(e,t,a){"use strict";a.d(t,{OQ:function(){return d},jv:function(){return s}});var r=a(1545),n=a(257);let o=n.env.NEXT_PUBLIC_SUPABASE_URL||"",c=n.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",s=()=>!!(o&&c),i=null,l=()=>s()?(i||(i=(0,r.eI)(o,c)),i):(console.warn("⚠️ Supabase credentials not configured. Using mock data."),null),d=new Proxy({},{get(e,t){let a=l();if(!a)throw Error("Supabase not configured");return a[t]}})},2660:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},8930:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},function(e){e.O(0,[211,868,990,971,117,744],function(){return e(e.s=3422)}),_N_E=e.O()}]);