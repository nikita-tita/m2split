(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[657],{3422:function(e,a,t){Promise.resolve().then(t.bind(t,6527))},6527:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return b}});var r=t(7437),s=t(2265),l=t(6383),n=t(9178),c=t(4226),i=t(8068),d=t(9379),o=t(5930),u=t(2660),h=t(9397),x=t(8930),j=t(2097),v=t(3694),p=t(1384),m=t(7648),g=t(9376);function b(){let e=(0,g.useRouter)(),{addDeal:a}=(0,j.o)(),[t,b]=(0,s.useState)(""),[N,f]=(0,s.useState)(""),[y,C]=(0,s.useState)(""),[I,P]=(0,s.useState)(""),[R,D]=(0,s.useState)(""),[w,A]=(0,s.useState)(""),[S,z]=(0,s.useState)([]),T=e=>{z(S.filter((a,t)=>t!==e))},_=(e,a,t)=>{let r=[...S];r[e]={...r[e],[a]:t},"taxRegime"===a&&"VAT"===t?r[e].vatRate=20:"taxRegime"===a&&"VAT"!==t&&(r[e].vatRate=void 0),"sharePercent"===a&&I&&parseFloat(I),z(r)},E=S.reduce((e,a)=>e+a.sharePercent,0),k=.01>Math.abs(E-100),F=t&&N&&I&&S.length>0&&k;return(0,r.jsx)(l.Layout,{children:(0,r.jsxs)("form",{onSubmit:r=>{if(r.preventDefault(),!F)return;let s="d".concat(Date.now()),l=parseFloat(I),n=S.map((e,a)=>{let t=v.dp.find(a=>a.id===e.contractorId);return{id:"s".concat(s,"_").concat(a),contractorId:e.contractorId,contractor:t,role:e.role,sharePercent:e.sharePercent,amount:l*e.sharePercent/100,taxRegime:e.taxRegime,vatRate:e.vatRate,contractNumber:e.contractNumber||void 0,contractDate:e.contractDate?new Date(e.contractDate):void 0}});a({id:s,objectName:t,objectAddress:N,lotNumber:y||void 0,developerId:"1",totalAmount:l,status:"DRAFT",shares:n,contractNumber:R||void 0,contractDate:w?new Date(w):void 0,responsibleUserId:"2",initiator:{role:"M2_OPERATOR",partyId:"1",userId:"2",timestamp:new Date},createdAt:new Date,updatedAt:new Date}),e.push("/deals/".concat(s))},className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(m.default,{href:"/deals",children:(0,r.jsx)(c.z,{type:"button",variant:"ghost",size:"sm",children:(0,r.jsx)(u.Z,{className:"w-5 h-5"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Создание сделки"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Укажите объект и распределите доли между участниками"})]})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(m.default,{href:"/deals",children:(0,r.jsx)(c.z,{type:"button",variant:"secondary",children:"Отмена"})}),(0,r.jsx)(c.z,{type:"submit",disabled:!F,children:"Создать сделку"})]})]}),(0,r.jsxs)(n.Z,{children:[(0,r.jsx)(n.O,{title:"Основная информация"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(i.I,{label:"Название объекта",placeholder:"ЖК Солнечный",value:t,onChange:e=>b(e.target.value),required:!0}),(0,r.jsx)(i.I,{label:"Адрес объекта",placeholder:"г. Москва, ул. Солнечная, д. 10",value:N,onChange:e=>f(e.target.value),required:!0}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(i.I,{label:"Лот (квартира, офис)",placeholder:"Кв. 45",value:y,onChange:e=>C(e.target.value)}),(0,r.jsx)(i.I,{label:"Сумма комиссии (₽)",type:"number",placeholder:"15000000",value:I,onChange:e=>P(e.target.value),required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(i.I,{label:"Номер договора",placeholder:"ДК-2024-001",value:R,onChange:e=>D(e.target.value)}),(0,r.jsx)(i.I,{label:"Дата договора",type:"date",value:w,onChange:e=>A(e.target.value)})]})]})]}),(0,r.jsxs)(n.Z,{padding:"none",children:[(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(n.O,{title:"Распределение долей"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Сумма долей: ",E.toFixed(2),"%"," ",k?(0,r.jsx)(d.C,{variant:"success",size:"sm",children:"✓ Корректно"}):(0,r.jsx)(d.C,{variant:"danger",size:"sm",children:"Должно быть 100%"})]})]}),(0,r.jsxs)(c.z,{type:"button",variant:"secondary",size:"sm",onClick:()=>{z([...S,{contractorId:"",role:"AGENT",sharePercent:0,taxRegime:"USN",contractNumber:"",contractDate:""}])},children:[(0,r.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),"Добавить получателя"]})]})}),S.length>0&&(0,r.jsxs)(o.iA,{children:[(0,r.jsx)(o.xD,{children:(0,r.jsxs)(o.SC,{children:[(0,r.jsx)(o.pj,{header:!0,children:"Контрагент"}),(0,r.jsx)(o.pj,{header:!0,children:"Роль"}),(0,r.jsx)(o.pj,{header:!0,children:"Доля %"}),(0,r.jsx)(o.pj,{header:!0,children:"Сумма"}),(0,r.jsx)(o.pj,{header:!0,children:"Режим"}),(0,r.jsx)(o.pj,{header:!0,children:"НДС %"}),(0,r.jsx)(o.pj,{header:!0,children:"Договор"}),(0,r.jsx)(o.pj,{header:!0,children:" "})]})}),(0,r.jsx)(o.RM,{children:S.map((e,a)=>{var t;return(0,r.jsxs)(o.SC,{children:[(0,r.jsx)(o.pj,{children:(0,r.jsx)(i.P,{value:e.contractorId,onChange:e=>_(a,"contractorId",e.target.value),options:[{value:"",label:"Выберите контрагента"},...v.dp.map(e=>({value:e.id,label:"".concat(e.name," (").concat(e.inn,")")}))]})}),(0,r.jsx)(o.pj,{children:(0,r.jsx)(i.P,{value:e.role,onChange:e=>_(a,"role",e.target.value),options:[{value:"AGENCY",label:"АН"},{value:"AGENT",label:"Агент"},{value:"IP",label:"ИП"},{value:"NPD",label:"НПД"}]})}),(0,r.jsx)(o.pj,{children:(0,r.jsx)(i.I,{type:"number",step:"0.01",min:"0",max:"100",value:e.sharePercent||"",onChange:e=>_(a,"sharePercent",parseFloat(e.target.value)||0)})}),(0,r.jsx)(o.pj,{className:"font-medium",children:I&&e.sharePercent?(0,p.xG)(parseFloat(I)*e.sharePercent/100):"—"}),(0,r.jsx)(o.pj,{children:(0,r.jsx)(i.P,{value:e.taxRegime,onChange:e=>_(a,"taxRegime",e.target.value),options:[{value:"VAT",label:"НДС"},{value:"USN",label:"УСН"},{value:"NPD",label:"НПД"}]})}),(0,r.jsx)(o.pj,{children:"VAT"===e.taxRegime?(0,r.jsx)(i.P,{value:(null===(t=e.vatRate)||void 0===t?void 0:t.toString())||"20",onChange:e=>_(a,"vatRate",parseInt(e.target.value)),options:[{value:"0",label:"0%"},{value:"10",label:"10%"},{value:"20",label:"20%"}]}):"—"}),(0,r.jsx)(o.pj,{children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i.I,{placeholder:"№ договора",value:e.contractNumber,onChange:e=>_(a,"contractNumber",e.target.value)}),(0,r.jsx)(i.I,{type:"date",value:e.contractDate,onChange:e=>_(a,"contractDate",e.target.value)})]})}),(0,r.jsx)(o.pj,{children:(0,r.jsx)(c.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>T(a),children:(0,r.jsx)(x.Z,{className:"w-4 h-4 text-red-600"})})})]},a)})})]}),0===S.length&&(0,r.jsx)("div",{className:"text-center py-12 border-t",children:(0,r.jsx)("p",{className:"text-gray-500",children:"Нажмите “Добавить получателя” для распределения долей"})})]})]})})}},9379:function(e,a,t){"use strict";t.d(a,{C:function(){return l}});var r=t(7437);t(2265);var s=t(1994);let l=e=>{let{children:a,variant:t="default",size:l="md"}=e;return(0,r.jsx)("span",{className:(0,s.W)("inline-flex items-center rounded-full font-medium",{default:"bg-gray-100 text-gray-800",success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",danger:"bg-red-100 text-red-800",info:"bg-blue-100 text-blue-800"}[t],{sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-1 text-sm"}[l]),children:a})}}},function(e){e.O(0,[837,757,971,117,744],function(){return e(e.s=3422)}),_N_E=e.O()}]);