(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[772],{2976:function(e,s,t){Promise.resolve().then(t.bind(t,6473))},6473:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return w}});var a=t(7437),r=t(2265),l=t(824),n=t(9178),c=t(4226),i=t(8068),d=t(9379),o=t(5930),u=t(2735),x=t(9397),j=t(1817),m=t(1384),h=t(3375),p=t(7887),N=t(3702),f=t(8332),v=t(9280),b=t(2097),g=t(7648),y=t(9376);function w(){let e=(0,y.useRouter)(),{currentRole:s}=(0,b.o)(),[t,w]=(0,r.useState)([]),[C,R]=(0,r.useState)(!0),[A,D]=(0,r.useState)(""),[_,I]=(0,r.useState)("all");(0,r.useEffect)(()=>{k()},[]);let k=async()=>{try{R(!0);let e=await p.P.getDeals();w(e)}catch(e){console.error("Failed to load deals:",e)}finally{R(!1)}},E=t.filter(e=>{let s=e.objectName.toLowerCase().includes(A.toLowerCase())||e.objectAddress.toLowerCase().includes(A.toLowerCase())||e.lotNumber&&e.lotNumber.toLowerCase().includes(A.toLowerCase()),t="all"===_||e.status===_;return s&&t}),S=e=>(0,a.jsx)(d.C,{variant:{DRAFT:"default",IN_PROGRESS:"info",IN_REGISTRY:"warning",PAID:"success"}[e]||"default",children:{DRAFT:"Черновик",IN_PROGRESS:"В работе",IN_REGISTRY:"В реестре",PAID:"Выплачено",PARTIALLY_PAID:"Частично",CANCELLED:"Отменено"}[e]||e});return(0,a.jsx)(l.A,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Сделки"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Управление сделками и распределением комиссий"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)(c.z,{variant:"secondary",onClick:()=>(0,h.Ww)(t),children:[(0,a.jsx)(u.Z,{className:"w-5 h-5 mr-2"}),"Экспорт"]}),(0,a.jsx)(g.default,{href:"/deals/new",children:(0,a.jsxs)(c.z,{children:[(0,a.jsx)(x.Z,{className:"w-5 h-5 mr-2"}),"Создать сделку"]})})]})]}),"CONTRACTOR"===s&&(0,a.jsx)(v.N,{id:"contractor-deals-list",title:"\uD83D\uDCCB Ваши сделки по заявкам застройщиков",description:"Здесь отображаются все сделки, которые вы создали, работая с базой контактов от застройщиков. Следите за статусами: Черновик → В работе → В реестре → Выплачено. Когда застройщик оплатит заявку, М2 автоматически распределит комиссию между всеми исполнителями."}),"AGENCY_ADMIN"===s&&(0,a.jsx)(v.N,{id:"agency-deals-list",title:"\uD83D\uDCCA Сделки вашего агентства",description:"Отслеживайте все сделки вашего агентства по заявкам застройщиков. Видите распределение долей между вашими агентами. М2 автоматически разделит комиссию между исполнителями после оплаты заявки застройщиком."}),"M2_OPERATOR"===s&&(0,a.jsx)(v.N,{id:"m2-deals-list",title:"\uD83C\uDFAF Управление заявками застройщиков",description:"Контролируйте все заявки застройщиков и их выполнение. Здесь видно, какие исполнители (агенты/АН) работают над каждой заявкой. Когда исполнителей несколько, система автоматически сплитит комиссию по их долям."}),(0,a.jsx)(N.E,{...f.p.dealsList}),(0,a.jsx)(n.Z,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)("div",{className:"md:col-span-2",children:(0,a.jsx)(i.I,{placeholder:"Поиск по объекту, адресу или лоту...",value:A,onChange:e=>D(e.target.value)})}),(0,a.jsx)(i.P,{value:_,onChange:e=>I(e.target.value),options:[{value:"all",label:"Все статусы"},{value:"DRAFT",label:"Черновик"},{value:"IN_PROGRESS",label:"В работе"},{value:"IN_REGISTRY",label:"В реестре"},{value:"PAID",label:"Выплачено"}]})]})}),(0,a.jsx)(n.Z,{padding:"none",children:C?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(j.Z,{className:"w-8 h-8 animate-spin mx-auto text-gray-400"}),(0,a.jsx)("p",{className:"text-gray-500 mt-4",children:"Загрузка сделок..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o.iA,{children:[(0,a.jsx)(o.xD,{children:(0,a.jsxs)(o.SC,{children:[(0,a.jsx)(o.pj,{header:!0,children:"№ сделки"}),(0,a.jsx)(o.pj,{header:!0,children:"Объект"}),(0,a.jsx)(o.pj,{header:!0,children:"Лот"}),(0,a.jsx)(o.pj,{header:!0,children:"Сумма КВН"}),(0,a.jsx)(o.pj,{header:!0,children:"Участников"}),(0,a.jsx)(o.pj,{header:!0,children:"Статус"}),(0,a.jsx)(o.pj,{header:!0,children:"Дата создания"}),(0,a.jsx)(o.pj,{header:!0,children:" "})]})}),(0,a.jsx)(o.RM,{children:E.map(s=>(0,a.jsxs)(o.SC,{onClick:()=>e.push("/deals/".concat(s.id)),className:"cursor-pointer hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(o.pj,{children:(0,a.jsx)("span",{className:"font-mono text-xs",children:s.dealNumber||s.id})}),(0,a.jsx)(o.pj,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:s.objectName}),(0,a.jsx)("div",{className:"text-xs text-gray-500 max-w-xs truncate",children:s.objectAddress})]})}),(0,a.jsx)(o.pj,{children:s.lotNumber||"—"}),(0,a.jsx)(o.pj,{className:"font-medium",children:(0,m.xG)(s.totalAmount)}),(0,a.jsx)(o.pj,{children:(0,a.jsx)("span",{className:"text-gray-600",children:s.shares.length})}),(0,a.jsx)(o.pj,{children:S(s.status)}),(0,a.jsx)(o.pj,{children:(0,m.p6)(s.createdAt)}),(0,a.jsx)(o.pj,{children:(0,a.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,a.jsx)(g.default,{href:"/deals/".concat(s.id),children:(0,a.jsx)(c.z,{variant:"ghost",size:"sm",children:"Открыть"})})})})]},s.id))})]}),0===E.length&&!C&&(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-gray-500",children:A||"all"!==_?"Сделки не найдены":"Пока нет сделок. Создайте первую сделку!"})})]})})]})})}},8068:function(e,s,t){"use strict";t.d(s,{I:function(){return l},P:function(){return n}});var a=t(7437);t(2265);var r=t(1994);let l=e=>{let{label:s,error:t,helperText:l,className:n,...c}=e;return(0,a.jsxs)("div",{className:"w-full",children:[s&&(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s}),(0,a.jsx)("input",{className:(0,r.W)("w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",t?"border-red-300":"border-gray-300",n),...c}),t&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:t}),l&&!t&&(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:l})]})},n=e=>{let{label:s,error:t,options:l,className:n,...c}=e;return(0,a.jsxs)("div",{className:"w-full",children:[s&&(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s}),(0,a.jsx)("select",{className:(0,r.W)("w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",t?"border-red-300":"border-gray-300",n),...c,children:l.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))}),t&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:t})]})}},3375:function(e,s,t){"use strict";t.d(s,{Ww:function(){return i},ig:function(){return c}});var a=t(1384);let r=e=>["Получатель,ИНН,Счёт,БИК,Сумма,Режим налогообложения,Ставка НДС,Договор №,Дата договора,Комментарий",...e.lines.map(e=>{var s,t;return[(null===(s=e.contractor)||void 0===s?void 0:s.name)||"",e.inn,e.accountNumber,e.bik,e.amount.toFixed(2),e.taxRegime,(null===(t=e.vatRate)||void 0===t?void 0:t.toString())||"",e.contractNumber||"",e.contractDate?(0,a.p6)(e.contractDate):"",e.comment||""]}).map(e=>e.map(e=>'"'.concat(e,'"')).join(","))].join("\n"),l=e=>["№ сделки,Объект,Адрес,Лот,Сумма КВН,Статус,Дата создания",...e.map(e=>[e.id,e.objectName,e.objectAddress,e.lotNumber||"",e.totalAmount.toFixed(2),e.status,(0,a.p6)(e.createdAt)]).map(e=>e.map(e=>'"'.concat(e,'"')).join(","))].join("\n"),n=(e,s,t)=>{let a=new Blob([e],{type:t}),r=URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download=s,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r)},c=e=>{n(r(e),"registry_".concat(e.registryNumber,"_").concat((0,a.p6)(new Date),".csv"),"text/csv;charset=utf-8;")},i=e=>{n(l(e),"deals_".concat((0,a.p6)(new Date),".csv"),"text/csv;charset=utf-8;")}},2735:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9205).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])}},function(e){e.O(0,[211,545,769,652,132,971,117,744],function(){return e(e.s=2976)}),_N_E=e.O()}]);