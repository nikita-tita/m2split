(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[847],{1602:function(e,t,r){Promise.resolve().then(r.bind(r,7218))},7218:function(e,t,r){"use strict";r.d(t,{default:function(){return D}});var a=r(7437),n=r(2265),s=r(824),i=r(9178),c=r(4226),d=r(9379),o=r(5930),l=r(2660),u=r(1817),m=r(1671),p=r(9388);let y=(0,r(9205).Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var x=r(2735),h=r(2097),g=r(1384),N=r(2141),f=r(3694);class j{async getRegistries(e){if(!(0,N.jv)()){let{registries:e}=h.o.getState();return e.length>0?e:f.nh}try{let t=N.OQ.from("registries").select("*").order("created_at",{ascending:!1});(null==e?void 0:e.status)&&(t=t.eq("status",e.status)),(null==e?void 0:e.developerId)&&(t=t.eq("developer_id",e.developerId));let{data:r,error:a}=await t;if(a)throw a;return r||[]}catch(e){throw console.error("Error fetching registries:",e),e}}async getRegistry(e){if(!(0,N.jv)()){let{registries:t}=h.o.getState();return t.find(t=>t.id===e)||f.nh.find(t=>t.id===e)||null}try{let{data:t,error:r}=await N.OQ.from("registries").select("\n          *,\n          registry_payment_lines(*)\n        ").eq("id",e).single();if(r)throw r;return t}catch(e){return console.error("Error fetching registry:",e),null}}async createRegistry(e){if(!(0,N.jv)()){let t={...e,id:"r".concat(Date.now()),createdAt:new Date,updatedAt:new Date};return h.o.getState().addRegistry(t),t}try{let{data:t,error:r}=await N.OQ.from("registries").insert([{registry_number:e.registryNumber,date:e.date,status:e.status,total_amount:e.totalAmount,lines_count:e.linesCount,creator_id:e.creatorId}]).select().single();if(r)throw r;if(e.lines&&e.lines.length>0){let r=e.lines.map(e=>({registry_id:t.id,contractor_id:e.contractorId,role:e.role,inn:e.inn,account_number:e.accountNumber,bik:e.bik,amount:e.amount,tax_regime:e.taxRegime,vat_rate:e.vatRate,contract_number:e.contractNumber,contract_date:e.contractDate,comment:e.comment,payment_status:e.paymentStatus}));await N.OQ.from("registry_payment_lines").insert(r)}return t}catch(e){throw console.error("Error creating registry:",e),e}}async updateRegistryStatus(e,t){if(!(0,N.jv)()){let{updateRegistry:r}=h.o.getState();r(e,{status:t});return}try{let{error:r}=await N.OQ.from("registries").update({status:t,updated_at:new Date}).eq("id",e);if(r)throw r}catch(e){throw console.error("Error updating registry status:",e),e}}async updatePaymentLineStatus(e,t,r,a){if(!(0,N.jv)()){console.log("Update payment line status (mock):",e,t);return}try{let{error:n}=await N.OQ.from("registry_payment_lines").update({payment_status:t,bank_error_code:r,bank_error_text:a,updated_at:new Date}).eq("id",e);if(n)throw n}catch(e){throw console.error("Error updating payment line status:",e),e}}}let v=new j;var A=r(8509),E=r(7648);function D(e){var t;let{id:r}=e,{registries:N,currentRole:f,updateRegistry:j}=(0,h.o)(),D=N.find(e=>e.id===r),[w,b]=(0,n.useState)(!1);if(!D)return(0,a.jsx)(s.A,{children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Реестр не найден"}),(0,a.jsx)(E.default,{href:"/registries",children:(0,a.jsx)(c.z,{className:"mt-4",children:"Вернуться к списку"})})]})});let R=async()=>{b(!0);try{try{await v.updateRegistryStatus(D.id,"APPROVED")}catch(e){console.warn("Supabase not configured, updating store directly")}j(D.id,{status:"APPROVED",approvedAt:new Date}),await A.W.logEvent({type:"REGISTRY_APPROVED",entityType:"REGISTRY",entityId:D.id,userId:"1",userName:"Developer Admin",userRole:f,description:"Реестр ".concat(D.registryNumber," утверждён застройщиком"),metadata:{registryNumber:D.registryNumber,totalAmount:D.totalAmount,linesCount:D.linesCount}}),alert("Реестр утверждён")}catch(e){console.error("Failed to approve registry:",e),alert("Не удалось утвердить реестр")}finally{b(!1)}},_=async()=>{let e=prompt("Укажите причину отклонения:");if(e){b(!0);try{try{await v.updateRegistryStatus(D.id,"DRAFT")}catch(e){console.warn("Supabase not configured, updating store directly")}j(D.id,{status:"DRAFT"}),await A.W.logEvent({type:"REGISTRY_APPROVED",entityType:"REGISTRY",entityId:D.id,userId:"1",userName:"Developer Admin",userRole:f,description:"Реестр ".concat(D.registryNumber," отклонён: ").concat(e),metadata:{registryNumber:D.registryNumber,rejectionReason:e}}),alert("Реестр отклонён")}catch(e){console.error("Failed to reject registry:",e),alert("Не удалось отклонить реестр")}finally{b(!1)}}},I=async()=>{b(!0);try{try{await v.updateRegistryStatus(D.id,"SENT_TO_BANK")}catch(e){console.warn("Supabase not configured, updating store directly")}j(D.id,{status:"SENT_TO_BANK",sentToBankAt:new Date}),await A.W.logEvent({type:"REGISTRY_SENT_TO_BANK",entityType:"REGISTRY",entityId:D.id,userId:"2",userName:"M2 Operator",userRole:f,description:"Реестр ".concat(D.registryNumber," отправлен в банк"),metadata:{registryNumber:D.registryNumber,totalAmount:D.totalAmount,linesCount:D.linesCount}}),alert("Реестр отправлен в банк")}catch(e){console.error("Failed to send registry to bank:",e),alert("Не удалось отправить реестр в банк")}finally{b(!1)}},T=async(e,t,r)=>{b(!0);try{let a,n;if("ERROR"===t&&(a=prompt("Код ошибки банка:")||void 0,!(n=prompt("Описание ошибки:")||void 0))){alert("Необходимо указать описание ошибки"),b(!1);return}try{await v.updatePaymentLineStatus(e,t,a,n)}catch(e){console.warn("Supabase not configured, updating store directly")}let s=D.lines.map(r=>r.id===e?{...r,paymentStatus:t,bankErrorCode:a,bankErrorText:n}:r);j(D.id,{lines:s}),await A.W.logEvent({type:"PAYMENT_STATUS_CHANGED",entityType:"PAYMENT",entityId:e,userId:"2",userName:"M2 Operator",userRole:f,description:"Статус выплаты изменён: ".concat(r||"Получатель"," → ").concat(P(t)),metadata:{registryId:D.id,registryNumber:D.registryNumber,lineId:e,newStatus:t,errorCode:a,errorText:n}}),alert("Статус выплаты обновлён: ".concat(P(t)))}catch(e){console.error("Failed to update payment status:",e),alert("Не удалось обновить статус выплаты")}finally{b(!1)}},P=e=>({PENDING:"Ожидание",ACCEPTED_BY_BANK:"Принято банком",EXECUTED:"Исполнено",ERROR:"Ошибка"})[e]||e,C=e=>(0,a.jsx)(d.C,{variant:{PENDING:"default",ACCEPTED_BY_BANK:"info",EXECUTED:"success",ERROR:"danger"}[e]||"default",size:"sm",children:P(e)});return(0,a.jsx)(s.A,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(E.default,{href:"/registries",children:(0,a.jsx)(c.z,{variant:"ghost",size:"sm",children:(0,a.jsx)(l.Z,{className:"w-5 h-5"})})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-gray-900",children:["Реестр ",D.registryNumber]}),(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["от ",(0,g.p6)(D.date)]})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:["DEVELOPER_ADMIN"===f&&"PENDING_APPROVAL"===D.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.z,{variant:"primary",onClick:R,disabled:w,children:[w?(0,a.jsx)(u.Z,{className:"w-5 h-5 mr-2 animate-spin"}):(0,a.jsx)(m.Z,{className:"w-5 h-5 mr-2"}),"Утвердить реестр"]}),(0,a.jsxs)(c.z,{variant:"danger",onClick:_,disabled:w,children:[(0,a.jsx)(p.Z,{className:"w-5 h-5 mr-2"}),"Отклонить"]})]}),"M2_OPERATOR"===f&&"APPROVED"===D.status&&(0,a.jsxs)(c.z,{variant:"primary",onClick:I,disabled:w,children:[w?(0,a.jsx)(u.Z,{className:"w-5 h-5 mr-2 animate-spin"}):(0,a.jsx)(y,{className:"w-5 h-5 mr-2"}),"Отправить в банк"]}),(0,a.jsxs)(c.z,{variant:"secondary",children:[(0,a.jsx)(x.Z,{className:"w-5 h-5 mr-2"}),"Скачать"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(i.O,{title:"Статус"}),(0,a.jsx)("div",{className:"mt-2",children:(t=D.status,(0,a.jsx)(d.C,{variant:{DRAFT:"default",PENDING_APPROVAL:"warning",APPROVED:"info",SENT_TO_BANK:"info",EXECUTED:"success",ERROR:"danger"}[t]||"default",children:{DRAFT:"Черновик",PENDING_APPROVAL:"На утверждении",APPROVED:"Утверждён",SENT_TO_BANK:"Отправлен в банк",EXECUTED:"Исполнен",PARTIALLY_EXECUTED:"Частично",ERROR:"Ошибка"}[t]||t}))})]}),(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(i.O,{title:"Строк"}),(0,a.jsx)("div",{className:"mt-2 text-2xl font-bold",children:D.linesCount})]}),(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(i.O,{title:"Общая сумма"}),(0,a.jsx)("div",{className:"mt-2 text-2xl font-bold",children:(0,g.xG)(D.totalAmount)})]}),(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(i.O,{title:"Утверждён"}),(0,a.jsx)("div",{className:"mt-2 text-sm",children:D.approvedAt?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 text-green-600 inline mr-1"}),(0,g.p6)(D.approvedAt)]}):(0,a.jsx)("span",{className:"text-gray-400",children:"—"})})]})]}),(0,a.jsxs)(i.Z,{padding:"none",children:[(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(i.O,{title:"Строки выплат"})}),(0,a.jsxs)(o.iA,{children:[(0,a.jsx)(o.xD,{children:(0,a.jsxs)(o.SC,{children:[(0,a.jsx)(o.pj,{header:!0,children:"Получатель"}),(0,a.jsx)(o.pj,{header:!0,children:"ИНН"}),(0,a.jsx)(o.pj,{header:!0,children:"Роль"}),(0,a.jsx)(o.pj,{header:!0,children:"Сумма"}),(0,a.jsx)(o.pj,{header:!0,children:"Режим"}),(0,a.jsx)(o.pj,{header:!0,children:"НДС"}),(0,a.jsx)(o.pj,{header:!0,children:"Счёт"}),(0,a.jsx)(o.pj,{header:!0,children:"БИК"}),(0,a.jsx)(o.pj,{header:!0,children:"Статус выплаты"})]})}),(0,a.jsx)(o.RM,{children:D.lines.map(e=>{var t;return(0,a.jsxs)(o.SC,{children:[(0,a.jsx)(o.pj,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:null===(t=e.contractor)||void 0===t?void 0:t.name}),e.comment&&(0,a.jsx)("div",{className:"text-xs text-gray-500 max-w-xs",children:e.comment})]})}),(0,a.jsx)(o.pj,{children:(0,a.jsx)("span",{className:"font-mono text-sm",children:e.inn})}),(0,a.jsx)(o.pj,{children:(0,a.jsxs)(d.C,{size:"sm",variant:"info",children:["AGENCY"===e.role&&"АН","AGENT"===e.role&&"Агент","IP"===e.role&&"ИП","NPD"===e.role&&"НПД"]})}),(0,a.jsx)(o.pj,{className:"font-medium",children:(0,g.xG)(e.amount)}),(0,a.jsx)(o.pj,{children:(0,a.jsx)(d.C,{size:"sm",children:(0,g.gG)(e.taxRegime)})}),(0,a.jsx)(o.pj,{children:e.vatRate?"".concat(e.vatRate,"%"):"—"}),(0,a.jsx)(o.pj,{children:(0,a.jsx)("span",{className:"font-mono text-xs",children:e.accountNumber})}),(0,a.jsx)(o.pj,{children:(0,a.jsx)("span",{className:"font-mono text-xs",children:e.bik})}),(0,a.jsxs)(o.pj,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[C(e.paymentStatus),"M2_OPERATOR"===f&&("SENT_TO_BANK"===D.status||"EXECUTED"===D.status)&&"EXECUTED"!==e.paymentStatus&&(0,a.jsxs)("select",{value:e.paymentStatus,onChange:t=>{var r;return T(e.id,t.target.value,null===(r=e.contractor)||void 0===r?void 0:r.name)},disabled:w,className:"text-xs border border-gray-300 rounded px-2 py-1",children:[(0,a.jsx)("option",{value:"PENDING",children:"Ожидание"}),(0,a.jsx)("option",{value:"ACCEPTED_BY_BANK",children:"Принято банком"}),(0,a.jsx)("option",{value:"EXECUTED",children:"Исполнено"}),(0,a.jsx)("option",{value:"ERROR",children:"Ошибка"})]})]}),e.bankErrorText&&(0,a.jsxs)("div",{className:"text-xs text-red-600 mt-1",children:[e.bankErrorCode&&"[".concat(e.bankErrorCode,"] "),e.bankErrorText]})]})]},e.id)})})]})]}),(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(i.O,{title:"История изменений"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3 text-sm",children:[(0,a.jsx)("div",{className:"w-32 text-gray-500",children:(0,g.p6)(D.createdAt)}),(0,a.jsx)("div",{className:"flex-1",children:"Реестр создан"})]}),D.approvedAt&&(0,a.jsxs)("div",{className:"flex items-start gap-3 text-sm",children:[(0,a.jsx)("div",{className:"w-32 text-gray-500",children:(0,g.p6)(D.approvedAt)}),(0,a.jsx)("div",{className:"flex-1",children:"Реестр утверждён застройщиком"})]}),D.sentToBankAt&&(0,a.jsxs)("div",{className:"flex items-start gap-3 text-sm",children:[(0,a.jsx)("div",{className:"w-32 text-gray-500",children:(0,g.p6)(D.sentToBankAt)}),(0,a.jsx)("div",{className:"flex-1",children:"Отправлен в банк"})]}),D.executedAt&&(0,a.jsxs)("div",{className:"flex items-start gap-3 text-sm",children:[(0,a.jsx)("div",{className:"w-32 text-gray-500",children:(0,g.p6)(D.executedAt)}),(0,a.jsx)("div",{className:"flex-1",children:"Исполнен банком"})]})]})]})]})})}},9379:function(e,t,r){"use strict";r.d(t,{C:function(){return s}});var a=r(7437);r(2265);var n=r(1994);let s=e=>{let{children:t,variant:r="default",size:s="md"}=e;return(0,a.jsx)("span",{className:(0,n.W)("inline-flex items-center rounded-full font-medium",{default:"bg-gray-100 text-gray-800",success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",danger:"bg-red-100 text-red-800",info:"bg-blue-100 text-blue-800"}[r],{sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-1 text-sm"}[s]),children:t})}},4226:function(e,t,r){"use strict";r.d(t,{z:function(){return s}});var a=r(7437);r(2265);var n=r(1994);let s=e=>{let{variant:t="primary",size:r="md",className:s,children:i,disabled:c,...d}=e;return(0,a.jsx)("button",{className:(0,n.W)("inline-flex items-center justify-center rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"bg-transparent text-gray-700 hover:bg-gray-100 focus:ring-gray-500"}[t],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[r],s),disabled:c,...d,children:i})}},3694:function(e,t,r){"use strict";r.d(t,{G:function(){return s},L$:function(){return d},bs:function(){return a},dp:function(){return n},kG:function(){return c},nh:function(){return i}});let a=[{id:"1",email:"admin@developer.ru",name:"Иван Застройщиков",role:"DEVELOPER_ADMIN",createdAt:new Date("2024-01-01")},{id:"2",email:"operator@m2split.ru",name:"Мария Операторова",role:"M2_OPERATOR",createdAt:new Date("2024-01-01")},{id:"3",email:"agency@realty.ru",name:'АН "Недвижимость+"',role:"CONTRACTOR",createdAt:new Date("2024-01-15")}],n=[{id:"c1",type:"AGENCY",name:'АН "Недвижимость Плюс"',inn:"7701234567",kpp:"770101001",accountNumber:"40702810100000001234",bik:"044525225",bankName:"ПАО Сбербанк",address:"г. Москва, ул. Примерная, д. 1",offerAcceptedAt:new Date("2024-02-01"),offerAcceptanceChannel:"email",createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-02-01")},{id:"c2",type:"AGENT",name:"Петров Петр Петрович",inn:"771234567890",accountNumber:"40817810200000002345",bik:"044525225",bankName:"ПАО Сбербанк",address:"г. Москва, ул. Агентская, д. 2",offerAcceptedAt:new Date("2024-02-05"),offerAcceptanceChannel:"web",createdAt:new Date("2024-01-20"),updatedAt:new Date("2024-02-05")},{id:"c3",type:"NPD",name:"Сидорова Анна Ивановна",inn:"123456789012",accountNumber:"40817810300000003456",bik:"044525974",bankName:"ПАО ВТБ",address:"г. Санкт-Петербург, пр. Невский, д. 100",offerAcceptedAt:new Date("2024-02-10"),offerAcceptanceChannel:"mobile",createdAt:new Date("2024-01-25"),updatedAt:new Date("2024-02-10")}],s=[{id:"d1",objectName:'ЖК "Солнечный"',objectAddress:"г. Москва, ул. Солнечная, д. 10, корп. 1",lotNumber:"Кв. 45",developerId:"1",totalAmount:15e6,status:"IN_PROGRESS",shares:[{id:"s1",contractorId:"c1",contractor:n[0],role:"AGENCY",sharePercent:60,amount:9e6,taxRegime:"OSN",vatRate:20,contractNumber:"АГ-001/2024",contractDate:new Date("2024-02-01")},{id:"s2",contractorId:"c2",contractor:n[1],role:"AGENT",sharePercent:30,amount:45e5,taxRegime:"USN",contractNumber:"АГ-002/2024",contractDate:new Date("2024-02-05")},{id:"s3",contractorId:"c3",contractor:n[2],role:"NPD",sharePercent:10,amount:15e5,taxRegime:"NPD",contractNumber:"АГ-003/2024",contractDate:new Date("2024-02-10")}],contractBasis:"Договор комиссии",contractNumber:"ДК-2024-001",contractDate:new Date("2024-02-01"),specialAccountReceiptDate:new Date("2024-02-15"),responsibleUserId:"2",initiator:{role:"M2_OPERATOR",partyId:"1",userId:"2",timestamp:new Date("2024-02-01")},createdAt:new Date("2024-02-01"),updatedAt:new Date("2024-02-15")},{id:"d2",objectName:'ЖК "Морской бриз"',objectAddress:"г. Санкт-Петербург, наб. Морская, д. 5",lotNumber:"Кв. 102",developerId:"1",totalAmount:22e6,status:"DRAFT",shares:[{id:"s4",contractorId:"c1",contractor:n[0],role:"AGENCY",sharePercent:70,amount:154e5,taxRegime:"OSN",vatRate:20},{id:"s5",contractorId:"c2",contractor:n[1],role:"AGENT",sharePercent:30,amount:66e5,taxRegime:"USN"}],responsibleUserId:"2",initiator:{role:"AGENCY_ADMIN",partyId:"c1",userId:"3",timestamp:new Date("2024-03-01")},createdAt:new Date("2024-03-01"),updatedAt:new Date("2024-03-01")}],i=[{id:"r1",registryNumber:"РЕЕ-2024-001",date:new Date("2024-03-15"),status:"APPROVED",totalAmount:15e6,linesCount:3,creatorId:"2",approverId:"1",approvedAt:new Date("2024-03-16"),lines:[{id:"l1",registryId:"r1",contractorId:"c1",contractor:n[0],role:"AGENCY",inn:"7701234567",accountNumber:"40702810100000001234",bik:"044525225",amount:9e6,taxRegime:"OSN",vatRate:20,contractNumber:"АГ-001/2024",contractDate:new Date("2024-02-01"),comment:"Комиссия за сделку ЖК Солнечный кв.45",paymentStatus:"PENDING",createdAt:new Date("2024-03-15"),updatedAt:new Date("2024-03-15")},{id:"l2",registryId:"r1",contractorId:"c2",contractor:n[1],role:"AGENT",inn:"771234567890",accountNumber:"40817810200000002345",bik:"044525225",amount:45e5,taxRegime:"USN",contractNumber:"АГ-002/2024",contractDate:new Date("2024-02-05"),comment:"Агентское вознаграждение",paymentStatus:"PENDING",createdAt:new Date("2024-03-15"),updatedAt:new Date("2024-03-15")},{id:"l3",registryId:"r1",contractorId:"c3",contractor:n[2],role:"NPD",inn:"123456789012",accountNumber:"40817810300000003456",bik:"044525974",amount:15e5,taxRegime:"NPD",contractNumber:"АГ-003/2024",contractDate:new Date("2024-02-10"),comment:"Услуги самозанятого",paymentStatus:"PENDING",createdAt:new Date("2024-03-15"),updatedAt:new Date("2024-03-15")}],createdAt:new Date("2024-03-15"),updatedAt:new Date("2024-03-16")}],c=[{id:"p1",registryId:"r1",lineId:"l1",contractorId:"c1",amount:9e6,status:"EXECUTED",bankReference:"BNK-2024-001",executedAt:new Date("2024-03-17"),createdAt:new Date("2024-03-16"),updatedAt:new Date("2024-03-17")},{id:"p2",registryId:"r1",lineId:"l2",contractorId:"c2",amount:45e5,status:"ACCEPTED_BY_BANK",bankReference:"BNK-2024-002",createdAt:new Date("2024-03-16"),updatedAt:new Date("2024-03-16")},{id:"p3",registryId:"r1",lineId:"l3",contractorId:"c3",amount:15e5,status:"ERROR",bankErrorCode:"ERR-01",bankErrorText:"Неверный номер счёта получателя",createdAt:new Date("2024-03-16"),updatedAt:new Date("2024-03-16")}],d={specialAccountBalance:37e6,paidThisPeriod:9e6,pendingPayments:6e6,errorPayments:15e5,primaryDocCompletion:33.33,vatSavings:18e5}},8509:function(e,t,r){"use strict";r.d(t,{W:function(){return i}});var a=r(2141);let n=[];class s{async logEvent(e){let t={id:"evt".concat(Date.now()),type:e.type,entityType:e.entityType,entityId:e.entityId,userId:e.userId,userName:e.userName,userRole:e.userRole,description:e.description,metadata:e.metadata,timestamp:new Date};if(!(0,a.jv)())return n.push(t),console.log("\uD83D\uDCDD Event logged:",t),t;try{let{data:e,error:r}=await a.OQ.from("events").insert([{type:t.type,entity_type:t.entityType,entity_id:t.entityId,user_id:t.userId,user_name:t.userName,user_role:t.userRole,description:t.description,metadata:t.metadata,timestamp:t.timestamp}]).select().single();if(r)throw r;return{...t,id:e.id}}catch(e){return console.error("Failed to log event:",e),n.push(t),t}}async getEventsForEntity(e,t){if(!(0,a.jv)())return n.filter(r=>r.entityType===e&&r.entityId===t).sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime());try{let{data:r,error:n}=await a.OQ.from("events").select("*").eq("entity_type",e).eq("entity_id",t).order("timestamp",{ascending:!1});if(n)throw n;return(r||[]).map(this.mapEvent)}catch(e){return console.error("Failed to fetch events:",e),[]}}async getAllEvents(e){if(!(0,a.jv)()){let t=[...n];return(null==e?void 0:e.entityType)&&(t=t.filter(t=>t.entityType===e.entityType)),(null==e?void 0:e.userId)&&(t=t.filter(t=>t.userId===e.userId)),(null==e?void 0:e.type)&&(t=t.filter(t=>t.type===e.type)),t.sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime()),(null==e?void 0:e.limit)&&(t=t.slice(0,e.limit)),t}try{let t=a.OQ.from("events").select("*").order("timestamp",{ascending:!1});(null==e?void 0:e.entityType)&&(t=t.eq("entity_type",e.entityType)),(null==e?void 0:e.userId)&&(t=t.eq("user_id",e.userId)),(null==e?void 0:e.type)&&(t=t.eq("type",e.type)),(null==e?void 0:e.limit)&&(t=t.limit(e.limit));let{data:r,error:n}=await t;if(n)throw n;return(r||[]).map(this.mapEvent)}catch(e){return console.error("Failed to fetch events:",e),[]}}clearEventLog(){n=[]}mapEvent(e){return{id:e.id,type:e.type,entityType:e.entity_type,entityId:e.entity_id,userId:e.user_id,userName:e.user_name,userRole:e.user_role,description:e.description,metadata:e.metadata,timestamp:new Date(e.timestamp)}}}let i=new s},2141:function(e,t,r){"use strict";r.d(t,{OQ:function(){return l},jv:function(){return c}});var a=r(1545),n=r(257);let s=n.env.NEXT_PUBLIC_SUPABASE_URL||"",i=n.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",c=()=>!!(s&&i),d=null,o=()=>c()?(d||(d=(0,a.eI)(s,i)),d):(console.warn("⚠️ Supabase credentials not configured. Using mock data."),null),l=new Proxy({},{get(e,t){let r=o();if(!r)throw Error("Supabase not configured");return r[t]}})},2660:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},1671:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},9388:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},2735:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},1817:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},function(e){e.O(0,[211,545,990,971,117,744],function(){return e(e.s=1602)}),_N_E=e.O()}]);