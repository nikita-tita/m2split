(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[495],{6593:function(e,t,a){Promise.resolve().then(a.bind(a,9755))},9755:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var n=a(7437),l=a(2265),r=a(6383),s=a(9178),c=a(4226),i=a(8068),d=a(5930),o=a(2660),x=a(9397),u=a(8930),h=a(2097),j=a(3694),m=a(1384),v=a(7648),p=a(9376);function g(){let e=(0,p.useRouter)(),{addRegistry:t}=(0,h.o)(),[a,g]=(0,l.useState)(new Date().toISOString().split("T")[0]),[b,N]=(0,l.useState)([]),f=e=>{N(b.filter((t,a)=>a!==e))},y=(e,t,a)=>{let n=[...b];if(n[e]={...n[e],[t]:a},"taxRegime"===t&&"VAT"===a?n[e].vatRate=20:"taxRegime"===t&&"VAT"!==a&&(n[e].vatRate=void 0),"contractorId"===t){let t=j.dp.find(e=>e.id===a);t&&(n[e].role=t.role,n[e].taxRegime=t.taxRegime,"VAT"===t.taxRegime&&(n[e].vatRate=20))}N(n)},D=b.reduce((e,t)=>e+(t.amount||0),0),R=a&&b.length>0&&b.every(e=>e.contractorId&&e.amount>0);return(0,n.jsx)(r.Layout,{children:(0,n.jsxs)("form",{onSubmit:n=>{if(n.preventDefault(),!R)return;let l="r".concat(Date.now()),r="РЕЕ-".concat(new Date().getFullYear(),"-").concat(String(Math.floor(1e3*Math.random())).padStart(3,"0")),s=b.map((e,t)=>{let a=j.dp.find(t=>t.id===e.contractorId);return{id:"l".concat(l,"_").concat(t),registryId:l,contractorId:e.contractorId,contractor:a,role:e.role,inn:(null==a?void 0:a.inn)||"",accountNumber:(null==a?void 0:a.accountNumber)||"",bik:(null==a?void 0:a.bik)||"",amount:e.amount,taxRegime:e.taxRegime,vatRate:e.vatRate,contractNumber:e.contractNumber||void 0,contractDate:e.contractDate?new Date(e.contractDate):void 0,comment:e.comment||void 0,paymentStatus:"PENDING",createdAt:new Date,updatedAt:new Date}});t({id:l,registryNumber:r,date:new Date(a),status:"DRAFT",totalAmount:D,linesCount:b.length,creatorId:"2",lines:s,createdAt:new Date,updatedAt:new Date}),e.push("/registries/".concat(l))},className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)(v.default,{href:"/registries",children:(0,n.jsx)(c.z,{type:"button",variant:"ghost",size:"sm",children:(0,n.jsx)(o.Z,{className:"w-5 h-5"})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Создание реестра"}),(0,n.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Сформируйте реестр выплат для отправки в банк"})]})]}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)(v.default,{href:"/registries",children:(0,n.jsx)(c.z,{type:"button",variant:"secondary",children:"Отмена"})}),(0,n.jsx)(c.z,{type:"submit",disabled:!R,children:"Создать реестр"})]})]}),(0,n.jsxs)(s.Z,{children:[(0,n.jsx)(s.O,{title:"Основная информация"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsx)(i.I,{label:"Дата реестра",type:"date",value:a,onChange:e=>g(e.target.value),required:!0}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Общая сумма"}),(0,n.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:(0,m.xG)(D)})]})]})]}),(0,n.jsxs)(s.Z,{padding:"none",children:[(0,n.jsx)("div",{className:"p-6",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(s.O,{title:"Строки выплат"}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Добавьте получателей и суммы выплат"})]}),(0,n.jsxs)(c.z,{type:"button",variant:"secondary",size:"sm",onClick:()=>{N([...b,{contractorId:"",role:"AGENT",amount:0,taxRegime:"USN",contractNumber:"",contractDate:"",comment:""}])},children:[(0,n.jsx)(x.Z,{className:"w-4 h-4 mr-2"}),"Добавить строку"]})]})}),b.length>0&&(0,n.jsxs)(d.iA,{children:[(0,n.jsx)(d.xD,{children:(0,n.jsxs)(d.SC,{children:[(0,n.jsx)(d.pj,{header:!0,children:"Контрагент"}),(0,n.jsx)(d.pj,{header:!0,children:"Роль"}),(0,n.jsx)(d.pj,{header:!0,children:"Сумма (₽)"}),(0,n.jsx)(d.pj,{header:!0,children:"Режим"}),(0,n.jsx)(d.pj,{header:!0,children:"НДС %"}),(0,n.jsx)(d.pj,{header:!0,children:"Договор"}),(0,n.jsx)(d.pj,{header:!0,children:"Комментарий"}),(0,n.jsx)(d.pj,{header:!0,children:" "})]})}),(0,n.jsx)(d.RM,{children:b.map((e,t)=>{var a;return(0,n.jsxs)(d.SC,{children:[(0,n.jsx)(d.pj,{children:(0,n.jsx)(i.P,{value:e.contractorId,onChange:e=>y(t,"contractorId",e.target.value),options:[{value:"",label:"Выберите контрагента"},...j.dp.map(e=>({value:e.id,label:"".concat(e.name," (").concat(e.inn,")")}))]})}),(0,n.jsx)(d.pj,{children:(0,n.jsx)(i.P,{value:e.role,onChange:e=>y(t,"role",e.target.value),options:[{value:"AGENCY",label:"АН"},{value:"AGENT",label:"Агент"},{value:"IP",label:"ИП"},{value:"NPD",label:"НПД"}]})}),(0,n.jsx)(d.pj,{children:(0,n.jsx)(i.I,{type:"number",min:"0",step:"0.01",value:e.amount||"",onChange:e=>y(t,"amount",parseFloat(e.target.value)||0)})}),(0,n.jsx)(d.pj,{children:(0,n.jsx)(i.P,{value:e.taxRegime,onChange:e=>y(t,"taxRegime",e.target.value),options:[{value:"VAT",label:"НДС"},{value:"USN",label:"УСН"},{value:"NPD",label:"НПД"}]})}),(0,n.jsx)(d.pj,{children:"VAT"===e.taxRegime?(0,n.jsx)(i.P,{value:(null===(a=e.vatRate)||void 0===a?void 0:a.toString())||"20",onChange:e=>y(t,"vatRate",parseInt(e.target.value)),options:[{value:"0",label:"0%"},{value:"10",label:"10%"},{value:"20",label:"20%"}]}):"—"}),(0,n.jsx)(d.pj,{children:(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)(i.I,{placeholder:"№ договора",value:e.contractNumber,onChange:e=>y(t,"contractNumber",e.target.value)}),(0,n.jsx)(i.I,{type:"date",value:e.contractDate,onChange:e=>y(t,"contractDate",e.target.value)})]})}),(0,n.jsx)(d.pj,{children:(0,n.jsx)(i.I,{placeholder:"Назначение платежа",value:e.comment,onChange:e=>y(t,"comment",e.target.value)})}),(0,n.jsx)(d.pj,{children:(0,n.jsx)(c.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>f(t),children:(0,n.jsx)(u.Z,{className:"w-4 h-4 text-red-600"})})})]},t)})})]}),0===b.length&&(0,n.jsx)("div",{className:"text-center py-12 border-t",children:(0,n.jsx)("p",{className:"text-gray-500",children:"Нажмите “Добавить строку” для создания выплат"})})]})]})})}}},function(e){e.O(0,[837,757,971,117,744],function(){return e(e.s=6593)}),_N_E=e.O()}]);