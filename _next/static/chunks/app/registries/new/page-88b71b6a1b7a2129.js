(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[495],{6593:function(e,t,a){Promise.resolve().then(a.bind(a,9755))},9755:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var r=a(7437),n=a(2265),s=a(824),l=a(9178),c=a(4226),i=a(8068),d=a(5930),o=a(2660),u=a(9397),x=a(8930),h=a(2097),m=a(3694),j=a(1384),p=a(8509),v=a(3702),g=a(8332),b=a(9280),N=a(7648),f=a(9376);function y(){let e=(0,f.useRouter)(),{addRegistry:t,currentRole:a}=(0,h.o)(),[y,D]=(0,n.useState)(new Date().toISOString().split("T")[0]),[R,w]=(0,n.useState)([]),C=e=>{w(R.filter((t,a)=>a!==e))},I=(e,t,a)=>{let r=[...R];r[e]={...r[e],[t]:a},"taxRegime"===t&&"OSN"===a?r[e].vatRate=20:"taxRegime"===t&&"OSN"!==a&&(r[e].vatRate=void 0),w(r)},k=R.reduce((e,t)=>e+(t.amount||0),0),S=y&&R.length>0&&R.every(e=>e.contractorId&&e.amount>0);return(0,r.jsx)(s.A,{children:(0,r.jsxs)("form",{onSubmit:a=>{if(a.preventDefault(),!S)return;let r="r".concat(Date.now()),n="РЕЕ-".concat(new Date().getFullYear(),"-").concat(String(Math.floor(1e3*Math.random())).padStart(3,"0")),s=R.map((e,t)=>{let a=m.dp.find(t=>t.id===e.contractorId);return{id:"l".concat(r,"_").concat(t),registryId:r,contractorId:e.contractorId,contractor:a,role:e.role,inn:(null==a?void 0:a.inn)||"",accountNumber:(null==a?void 0:a.accountNumber)||"",bik:(null==a?void 0:a.bik)||"",amount:e.amount,taxRegime:e.taxRegime,vatRate:e.vatRate,contractNumber:e.contractNumber||void 0,contractDate:e.contractDate?new Date(e.contractDate):void 0,comment:e.comment||void 0,paymentStatus:"PENDING",createdAt:new Date,updatedAt:new Date}});t({id:r,registryNumber:n,date:new Date(y),status:"DRAFT",totalAmount:k,linesCount:R.length,creatorId:"2",lines:s,createdAt:new Date,updatedAt:new Date}),p.W.logEvent({type:"REGISTRY_CREATED",entityType:"REGISTRY",entityId:r,userId:"2",userName:"M2 Operator",userRole:"M2_OPERATOR",description:"Реестр создан: ".concat(n),metadata:{registryNumber:n,totalAmount:k,linesCount:R.length,date:y}}),e.push("/registries/".concat(r))},className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(N.default,{href:"/registries",children:(0,r.jsx)(c.z,{type:"button",variant:"ghost",size:"sm",children:(0,r.jsx)(o.Z,{className:"w-5 h-5"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Создание реестра"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Сформируйте реестр выплат для отправки в банк"})]})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(N.default,{href:"/registries",children:(0,r.jsx)(c.z,{type:"button",variant:"secondary",children:"Отмена"})}),(0,r.jsx)(c.z,{type:"submit",disabled:!S,children:"Создать реестр"})]})]}),"M2_OPERATOR"===a&&(0,r.jsx)(b.N,{id:"m2-registry-create",title:"\uD83D\uDCCB Формирование реестра выплат",description:"Здесь вы формируете реестр выплат исполнителям после того, как застройщик оплатил заявку. Добавьте всех исполнителей, укажите суммы сплита, и отправьте реестр в банк. М2 выплатит каждому исполнителю его долю со спецсчёта."}),"DEVELOPER_ADMIN"===a&&(0,r.jsx)(b.N,{id:"dev-registry-create",title:"\uD83D\uDCCA М2 формирует реестры автоматически",description:"Этот экран используется М2 для создания реестров выплат исполнителям ваших заявок. После оплаты заявки М2 автоматически распределяет комиссию между всеми участниками сделки и отправляет реестр в банк."}),(0,r.jsx)(v.E,{...g.p.registryCreation}),(0,r.jsxs)(l.Z,{children:[(0,r.jsx)(l.O,{title:"Основная информация"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(i.I,{label:"Дата реестра",type:"date",value:y,onChange:e=>D(e.target.value),required:!0}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Общая сумма"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:(0,j.xG)(k)})]})]})]}),(0,r.jsxs)(l.Z,{padding:"none",children:[(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(l.O,{title:"Строки выплат"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Добавьте получателей и суммы выплат"})]}),(0,r.jsxs)(c.z,{type:"button",variant:"secondary",size:"sm",onClick:()=>{w([...R,{contractorId:"",role:"AGENT",amount:0,taxRegime:"USN",contractNumber:"",contractDate:"",comment:""}])},children:[(0,r.jsx)(u.Z,{className:"w-4 h-4 mr-2"}),"Добавить строку"]})]})}),R.length>0&&(0,r.jsxs)(d.iA,{children:[(0,r.jsx)(d.xD,{children:(0,r.jsxs)(d.SC,{children:[(0,r.jsx)(d.pj,{header:!0,children:"Контрагент"}),(0,r.jsx)(d.pj,{header:!0,children:"Роль"}),(0,r.jsx)(d.pj,{header:!0,children:"Сумма (₽)"}),(0,r.jsx)(d.pj,{header:!0,children:"Режим"}),(0,r.jsx)(d.pj,{header:!0,children:"НДС %"}),(0,r.jsx)(d.pj,{header:!0,children:"Договор"}),(0,r.jsx)(d.pj,{header:!0,children:"Комментарий"}),(0,r.jsx)(d.pj,{header:!0,children:" "})]})}),(0,r.jsx)(d.RM,{children:R.map((e,t)=>{var a;return(0,r.jsxs)(d.SC,{children:[(0,r.jsx)(d.pj,{children:(0,r.jsx)(i.P,{value:e.contractorId,onChange:e=>I(t,"contractorId",e.target.value),options:[{value:"",label:"Выберите контрагента"},...m.dp.map(e=>({value:e.id,label:"".concat(e.name," (").concat(e.inn,")")}))]})}),(0,r.jsx)(d.pj,{children:(0,r.jsx)(i.P,{value:e.role,onChange:e=>I(t,"role",e.target.value),options:[{value:"AGENCY",label:"АН"},{value:"AGENT",label:"Агент"},{value:"IP",label:"ИП"},{value:"NPD",label:"НПД"}]})}),(0,r.jsx)(d.pj,{children:(0,r.jsx)(i.I,{type:"number",min:"0",step:"0.01",value:e.amount||"",onChange:e=>I(t,"amount",parseFloat(e.target.value)||0)})}),(0,r.jsx)(d.pj,{children:(0,r.jsx)(i.P,{value:e.taxRegime,onChange:e=>I(t,"taxRegime",e.target.value),options:[{value:"OSN",label:"НДС"},{value:"USN",label:"УСН"},{value:"NPD",label:"НПД"}]})}),(0,r.jsx)(d.pj,{children:"OSN"===e.taxRegime?(0,r.jsx)(i.P,{value:(null===(a=e.vatRate)||void 0===a?void 0:a.toString())||"20",onChange:e=>I(t,"vatRate",parseInt(e.target.value)),options:[{value:"0",label:"0%"},{value:"10",label:"10%"},{value:"20",label:"20%"}]}):"—"}),(0,r.jsx)(d.pj,{children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i.I,{placeholder:"№ договора",value:e.contractNumber,onChange:e=>I(t,"contractNumber",e.target.value)}),(0,r.jsx)(i.I,{type:"date",value:e.contractDate,onChange:e=>I(t,"contractDate",e.target.value)})]})}),(0,r.jsx)(d.pj,{children:(0,r.jsx)(i.I,{placeholder:"Назначение платежа",value:e.comment,onChange:e=>I(t,"comment",e.target.value)})}),(0,r.jsx)(d.pj,{children:(0,r.jsx)(c.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(t),children:(0,r.jsx)(x.Z,{className:"w-4 h-4 text-red-600"})})})]},t)})})]}),0===R.length&&(0,r.jsx)("div",{className:"text-center py-12 border-t",children:(0,r.jsx)("p",{className:"text-gray-500",children:"Нажмите “Добавить строку” для создания выплат"})})]})]})})}},8068:function(e,t,a){"use strict";a.d(t,{I:function(){return s},P:function(){return l}});var r=a(7437);a(2265);var n=a(1994);let s=e=>{let{label:t,error:a,helperText:s,className:l,...c}=e;return(0,r.jsxs)("div",{className:"w-full",children:[t&&(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),(0,r.jsx)("input",{className:(0,n.W)("w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",a?"border-red-300":"border-gray-300",l),...c}),a&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:a}),s&&!a&&(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:s})]})},l=e=>{let{label:t,error:a,options:s,className:l,...c}=e;return(0,r.jsxs)("div",{className:"w-full",children:[t&&(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),(0,r.jsx)("select",{className:(0,n.W)("w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",a?"border-red-300":"border-gray-300",l),...c,children:s.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))}),a&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:a})]})}},2660:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},9397:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},8930:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},function(e){e.O(0,[211,545,769,652,875,971,117,744],function(){return e(e.s=6593)}),_N_E=e.O()}]);