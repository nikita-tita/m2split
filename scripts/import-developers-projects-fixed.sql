-- Import developers and projects from CSV data (FIXED for UUID schema)
-- IMPORTANT: This system currently works only for Moscow region
-- Date: 2025-01-13

-- ============================================
-- DEVELOPERS (Застройщики)
-- ============================================

-- Insert developers from the provided list
INSERT INTO counterparties (type, name, inn, kpp, offer_accepted_at, created_at) VALUES
  ('DEVELOPER', 'Группа «Самолет»', '7750005606', '775001001', NOW(), NOW()),
  ('DEVELOPER', 'Группа «Родина»', '7728838886', '772801001', NOW(), NOW()),
  ('DEVELOPER', 'Unikey', '7750000001', '775000001', NOW(), NOW()),
  ('DEVELOPER', 'Брусника', '6670394684', '667001001', NOW(), NOW()),
  ('DEVELOPER', 'MR Group', '7710936098', '771001001', NOW(), NOW()),
  ('DEVELOPER', 'Plus Development', '7750000002', '775000002', NOW(), NOW()),
  ('DEVELOPER', 'Галс-Девелопмент', '7743003457', '774301001', NOW(), NOW()),
  ('DEVELOPER', 'ГК «ОСНОВА»', '7750000003', '775000003', NOW(), NOW()),
  ('DEVELOPER', 'Forma', '7750000004', '775000004', NOW(), NOW()),
  ('DEVELOPER', 'ГК ФСК', '7750000005', '775000005', NOW(), NOW()),
  ('DEVELOPER', 'ДОНСТРОЙ', '7728138022', '772801001', NOW(), NOW()),
  ('DEVELOPER', 'ЛСР. Недвижимость-Москва', '7750000006', '775000006', NOW(), NOW()),
  ('DEVELOPER', 'ДСК-1', '7750000007', '775000007', NOW(), NOW()),
  -- Additional developers needed for tariff import
  ('DEVELOPER', 'Level Group', '7750000008', '775000008', NOW(), NOW()),
  ('DEVELOPER', 'Capital Group', '7750000009', '775000009', NOW(), NOW()),
  ('DEVELOPER', 'ГК «МИЦ»', '7750000010', '775000010', NOW(), NOW())
ON CONFLICT (inn) DO UPDATE SET
  name = EXCLUDED.name,
  offer_accepted_at = EXCLUDED.offer_accepted_at;

-- ============================================
-- PROJECTS (ЖК) - Moscow only
-- ============================================

-- Insert projects from the CSV
INSERT INTO projects (developer_id, project_name, region, city, address, is_active, created_at)
SELECT
  c.id,
  p.project_name,
  p.region,
  p.city,
  p.address,
  TRUE,
  NOW()
FROM (VALUES
  -- Группа «Самолет»
  ('Группа «Самолет»', 'ЖК «Квартал Домашний»', 'Москва', 'Москва', 'ул. Донецкая'),
  ('Группа «Самолет»', '«Тропарево Парк»', 'Москва', 'Москва', 'Новомосковский округ, Коммунарка'),
  ('Группа «Самолет»', 'ЖК «Остафьево»', 'Москва', 'Москва', 'пос. Рязановское, Остафьево'),
  ('Группа «Самолет»', 'ЖК «Новое Внуково»', 'Москва', 'Москва', 'Новомосковский округ, Внуково'),
  ('Группа «Самолет»', 'ЖК «Алхимово»', 'Москва', 'Москва', 'пос. Рязановское, Алхимово'),
  ('Группа «Самолет»', 'ЖК «Квартал на воде»', 'Москва', 'Москва', 'ул. Шоссейная'),
  ('Группа «Самолет»', 'ЖК «Квартал Румянцево»', 'Москва', 'Москва', 'Новомосковский округ, Коммунарка'),
  ('Группа «Самолет»', 'ЖК «Ольховый Квартал»', 'Москва', 'Москва', 'Новомосковский округ, пос. Газопровод'),

  -- Группа «Родина»
  ('Группа «Родина»', 'ЖК «СОЮЗ»', 'Москва', 'Москва', 'ул. Сельскохозяйственная'),
  ('Группа «Родина»', 'ЖК «Родина Переделкино»', 'Москва', 'Москва', 'Боровское ш.'),

  -- Unikey
  ('Unikey', 'ЖК «Новые Смыслы»', 'Москва', 'Москва', 'ул. Александры Монаховой'),

  -- Брусника
  ('Брусника', 'Квартал «Метроном»', 'Москва', 'Москва', 'ул. Тагильская'),
  ('Брусника', 'Квартал «МОНС»', 'Москва', 'Москва', 'Огородный проезд'),
  ('Брусника', 'ЖК «Дом А»', 'Москва', 'Москва', 'ул. Дубининская'),

  -- MR Group
  ('MR Group', 'ЖК «SET»', 'Москва', 'Москва', 'ул. Верейская'),

  -- Plus Development
  ('Plus Development', 'ЖК «Детали»', 'Москва', 'Москва', 'пос. Филимонковское'),

  -- Галс-Девелопмент
  ('Галс-Девелопмент', 'ЖК «Монблан»', 'Москва', 'Москва', 'Шлюзовая наб.'),
  ('Галс-Девелопмент', 'ЖК «Рождественка 8»', 'Москва', 'Москва', 'ул. Кузнецкий Мост, 17'),

  -- ГК «ОСНОВА»
  ('ГК «ОСНОВА»', 'ЖК «МИРАПОЛИС»', 'Москва', 'Москва', 'пр. Мира, 222'),
  ('ГК «ОСНОВА»', 'ЖК «EVOPARK Измайлово»', 'Москва', 'Москва', 'ул. Электродная, 2А'),

  -- Forma
  ('Forma', 'ЖК «Moments»', 'Москва', 'Москва', 'Волоколамское ш.'),
  ('Forma', 'ЖК «SOUL»', 'Москва', 'Москва', 'ул. Часовая'),

  -- ГК ФСК
  ('ГК ФСК', 'ЖК «AMBER CITY»', 'Москва', 'Москва', 'ул. Розанова'),
  ('ГК ФСК', 'ЖК «Sky Garden»', 'Москва', 'Москва', 'Строительный проезд'),
  ('ГК ФСК', 'ЖК «Rotterdam»', 'Москва', 'Москва', 'Варшавское ш.'),

  -- ДОНСТРОЙ
  ('ДОНСТРОЙ', 'ЖК «Событие»', 'Москва', 'Москва', 'ул. Лобачевского'),

  -- ЛСР. Недвижимость-Москва
  ('ЛСР. Недвижимость-Москва', 'ЖК «ЛУЧИ»', 'Москва', 'Москва', 'ул. Производственная'),
  ('ЛСР. Недвижимость-Москва', 'ЖК «Дмитровское небо»', 'Москва', 'Москва', 'Ильменский проезд'),

  -- ДСК-1
  ('ДСК-1', '«1-й Саларьевский»', 'Москва', 'Москва', 'пос. Московский'),

  -- Level Group (additional projects for tariff import)
  ('Level Group', 'ЖК «Level Кавказский бульвар»', 'Москва', 'Москва', 'Кавказский бульвар'),
  ('Level Group', 'ЖК «Level Амурская»', 'Москва', 'Москва', 'ул. Амурская'),
  ('Level Group', 'ЖК «Level Павелецкая»', 'Москва', 'Москва', 'ул. Павелецкая'),
  ('Level Group', 'ЖК «Лефорт»', 'Москва', 'Москва', 'ул. Лефортовская'),
  ('Level Group', 'ЖК «Level Пресненский»', 'Москва', 'Москва', 'Пресненская наб.'),
  ('Level Group', 'ЖК «Река»', 'Москва', 'Москва', 'наб. Тараса Шевченко'),
  ('Level Group', 'ЖК «Level Амбулаторный»', 'Москва', 'Москва', 'Амбулаторный проезд'),
  ('Level Group', 'Дом «Level Римская»', 'Москва', 'Москва', 'пл. Рогожская Застава'),
  ('Level Group', 'ЖК «Level Сухаревская»', 'Москва', 'Москва', 'ул. Сретенка'),
  ('Level Group', 'ЖК «Level Донской»', 'Москва', 'Москва', 'ул. Донская'),
  ('Level Group', 'ЖК «Level Шереметьевская»', 'Москва', 'Москва', 'ул. Шереметьевская'),
  ('Level Group', 'ЖК «Level Ленинградский»', 'Москва', 'Москва', 'Ленинградский проспект')
) AS p(developer_name, project_name, region, city, address)
JOIN counterparties c ON c.name = p.developer_name AND c.type = 'DEVELOPER'
ON CONFLICT (developer_id, project_name) DO UPDATE SET
  address = EXCLUDED.address,
  is_active = EXCLUDED.is_active;

-- ============================================
-- VERIFY DATA
-- ============================================

-- Check imported developers
SELECT
  type,
  name,
  inn,
  offer_accepted_at IS NOT NULL as offer_accepted,
  created_at
FROM counterparties
WHERE type = 'DEVELOPER'
ORDER BY name;

-- Check imported projects
SELECT
  p.project_name,
  c.name as developer_name,
  p.city,
  p.address,
  p.is_active,
  (SELECT COUNT(*) FROM tariffs t WHERE t.project_id = p.id) as tariffs_count
FROM projects p
JOIN counterparties c ON c.id = p.developer_id
ORDER BY c.name, p.project_name;
